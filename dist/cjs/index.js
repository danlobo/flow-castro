"use strict";var e=require("react"),n=require("react/jsx-runtime");const t=e.createContext(null),o=({children:o})=>{const[i,r]=e.useState(null);return n.jsx(t.Provider,{value:{dragInfo:i,setDragInfo:r},children:o})},i=()=>{const{dragInfo:n,setDragInfo:o}=e.useContext(t);return{dragInfo:n,setDragInfo:o}},r=e.createContext(),s=({children:t,initialState:o,store:i})=>{const[s,a]=e.useState(o?.scale||1),[l,c]=e.useState(o?.position||{x:0,y:0});return n.jsx(r.Provider,{value:{scale:s,setScale:a,position:l,setPosition:c},children:t})},a=()=>{const{scale:n,setScale:t,position:o,setPosition:i}=e.useContext(r);return{scale:n,setScale:t,position:o,setPosition:i}};var l={port:"NodePort-module_port__aKb8R",input:"NodePort-module_input__nP24E",output:"NodePort-module_output__Q8Uf2",portOverlay:"NodePort-module_portOverlay__mjlyG",label:"NodePort-module_label__4Kc0j",formContainer:"NodePort-module_formContainer__lna8k",portConnector:"NodePort-module_portConnector__4GyCZ",circle:"NodePort-module_circle__3fRNv",square:"NodePort-module_square__QSRn2",diamond:"NodePort-module_diamond__NHCFW"};const c=(e,...n)=>{if(!n.length)return e;const t=n.shift();if(u(e)&&u(t))for(const n in t)u(t[n])?(e[n]||Object.assign(e,{[n]:{}}),c(e[n],t[n])):Object.assign(e,{[n]:t[n]});return c(e,...n)};function u(e){return e&&"object"==typeof e&&!Array.isArray(e)}function d(e){const n={roundness:0,nodes:{common:{padding:2,borderRadius:4,boxShadow:"0 0 8px rgba(0, 0, 0, 0.125)",title:{background:e.colors.hover,color:e.colors.text},body:{background:e.colors.background,border:`1px solid ${e.colors.border}`,color:e.colors.text}}},ports:{},connections:{},buttons:{default:{backgroundColor:e.colors.background,border:`1px solid ${e.colors.border}`,color:e.colors.text}},contextMenu:{background:e.colors.background,border:`1px solid ${e.colors.border}`,color:e.colors.text}};return c({},n,e)}const p={light:d({colors:{primary:"#0000ff",secondary:"#00ff00",background:"#ffffff44",text:"#222222",hover:"#f2f2f2",border:"#888",selectionBorder:"#888"}}),dark:d({colors:{primary:"#000088",secondary:"#008800",background:"#222",text:"#DDD",hover:"#333",border:"#888",selectionBorder:"#aaa"}})},f={themeName:"light",currentTheme:p.light,setThemeName:e=>{console.log("setThemeName not initialized")}},m=e.createContext(f),y=()=>e.useContext(m),v=(e,n,t,o)=>({x:e/o,y:n/o});function h({name:t,type:o,nodeId:r,label:s,hidePort:c,onConnected:u,isConnected:d,direction:p,value:f,onValueChange:m,canMove:h,options:x}){var g,b,C,w,S,P,M;const{currentTheme:N}=y(),{position:T,scale:E}=a(),{dragInfo:H,setDragInfo:V}=i(),[j,_]=e.useState(f),k=e.useMemo((()=>({circle:l.circle,square:l.square,diamond:l.diamond})),[]);e.useEffect((()=>{if(!t)throw new Error("Port name is required. NodeId: "+r)}),[t]),e.useEffect((()=>{}),[j]),e.useEffect((()=>{d&&m?.(null)}),[d]);const O=e.useRef(null),I=e.useRef(null);e.useCallback((e=>{e.preventDefault(),e.stopPropagation(),m?.(j)}),[j]);const L=e.useRef();e.useEffect((()=>{I.current&&(L.current=I.current.getBoundingClientRect())}),[I.current]);const Y=e.useRef();e.useEffect((()=>{O.current&&(Y.current=O.current.getBoundingClientRect())}),[O.current]);const[z,A]=e.useState({x:0,y:0});return n.jsxs("div",{ref:O,style:{cursor:!c&&h?"crosshair":null},className:[l.port,l[p]].join(" "),onMouseDown:e=>{if(c||!h)return;e.stopPropagation();const n=O.current.getBoundingClientRect();v(e.pageX-n.left,e.pageY-n.top,0,E);const i=I.current.getBoundingClientRect(),s={type:"connector",nodeId:r,portName:t,portType:o,startX:i.left,startY:i.top};V(s);const a=e=>{if(!s)return;if("connector"!==s.type)return;const t=v(e.pageX-n.left,e.pageY-n.top,0,E);A({x:t.x,y:t.y})},d=e=>{if(window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",d),V(null),!s)return;const n=document.elementsFromPoint(e.pageX-window.scrollX,e.pageY-window.scrollY).find((e=>e.classList?.contains(l.portOverlay)&&e.dataset.portDirection.toString()!==p.toString()&&e.dataset.portType.toString()===o.type?.toString()));n&&u?.({source:{nodeId:r,portName:t},target:{nodeId:n.dataset.nodeId,portName:n.dataset.portName}})};window.addEventListener("mousemove",a),window.addEventListener("mouseup",d)},children:[!c&&n.jsx("div",{className:[l.portOverlay,l[p]].join(" "),id:`card-${r}-${p}-${t}-overlay`,"data-port-name":t,"data-port-type":o.type,"data-port-direction":p,"data-node-id":r}),n.jsx("div",{className:l.label,style:{justifyContent:"input"===p?"flex-start":"flex-end"},children:n.jsx("span",{children:s})}),n.jsx("div",{className:l.formContainer,onMouseDown:e=>{e.stopPropagation()},children:null!==(g="input"===p&&!d&&o.render?.({value:f,onChange:m,options:x}))&&void 0!==g?g:null}),!c&&n.jsx("div",{id:`card-${r}-${p}-${t}`,ref:I,"data-port-connector-name":t,"data-port-connector-type":o.type,"data-port-connector-direction":p,"data-port-connector-connected":Boolean(d),style:{background:null!==(b=null!==(C=null!==(w=N.ports?.[null!==(S=o?.type)&&void 0!==S?S:"default"]?.color)&&void 0!==w?w:o?.color)&&void 0!==C?C:N.ports?.default?.color)&&void 0!==b?b:N.colors?.primary},className:[l.portConnector,l[p],null!==(P=k[null!==(M=o?.shape)&&void 0!==M?M:"circle"])&&void 0!==P?P:null].filter(Boolean).join(" ")})]})}var x=e.memo(h),g={node:"Node-module_node__yVhqG",selected:"Node-module_selected__bA-o1",title:"Node-module_title__IkogO",container:"Node-module_container__PfJft",portsContainer:"Node-module_portsContainer__3s5BH",inputPortsContainer:"Node-module_inputPortsContainer__FPkYh",outputPortsContainer:"Node-module_outputPortsContainer__qYiul"};function b({name:t,portTypes:o,nodeType:i,value:r,canMove:s,isSelected:l,onChangePosition:c,onDragStart:u,onDragEnd:d,onConnect:p,containerRef:f,onContextMenu:m,onResize:v,onValueChange:h,debugMode:b}){var C,w,S,P,M;const{currentTheme:N}=y(),T=e.useRef();e.useEffect((()=>{const e=T.current,n=new ResizeObserver((e=>{v({width:e[0].contentRect.width,height:e[0].contentRect.height})}));return n.observe(e),()=>{n.unobserve(e)}}),[]);const{id:E,name:H,position:V,values:j}=r;e.useEffect((()=>{if(null==E)throw new Error("Node id is required");if(null==t)throw new Error("Node name is required");t!==H&&console.warn("Node name mismatch",t,H)}),[t,H,E]);const{scale:_}=a(),k=e.useCallback((e=>{if(!s)return;e.stopPropagation();const n=e.pageX,t=e.pageY;u?.({x:V.x,y:V.y});const o=e=>{const o=e.pageX-n,i=e.pageY-t;c({x:V.x+o/_,y:V.y+i/_})},i=e=>{window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",i);const r=e.pageX-n,s=e.pageY-t;Math.abs(r)>=2&&Math.abs(s)>=2&&d?.({x:V.x+r/_,y:V.y+s/_})};window.addEventListener("mousemove",o),window.addEventListener("mouseup",i)}),[V,_,c,u,d]),O=e.useCallback((({source:e,target:n})=>{p?.({source:e,target:n})}),[p]),I=e.useCallback((({source:e,target:n})=>{p?.({source:n,target:e})}),[p]),L=e.useMemo((()=>"function"==typeof i.inputs?i.inputs(j):i.inputs),[i,j]);e.useEffect((()=>{if(null==L)return;if(null==j)return;const e=Object.keys(j).filter((e=>!L.some((n=>n.name===e))));if(e.length>0){const n=Object.keys(j).filter((n=>!e.includes(n))).reduce(((e,n)=>(e[n]=j[n],e)),{});h?.({...r,values:n})}}),[L]);const Y=e.useMemo((()=>"function"==typeof i.outputs?i.outputs(j,r.connections?.inputs):i.outputs),[i,j,r.connections?.inputs]);return n.jsxs("div",{ref:T,id:`card-${E}`,className:[g.node,l?g.selected:""].join(" "),style:{backgroundColor:null!==(C=N?.nodes?.[i?.type]?.body?.background)&&void 0!==C?C:N?.nodes?.common?.body?.background,border:null!==(w=N?.nodes?.[i?.type]?.body?.border)&&void 0!==w?w:N?.nodes?.common?.body?.border,color:null!==(S=N?.nodes?.[i?.type]?.body?.color)&&void 0!==S?S:N?.nodes?.common?.body?.color,transform:`translate(${V.x}px, ${V.y}px)`,cursor:s?"grab":null},onMouseDown:k,onContextMenu:m,children:[n.jsx("div",{className:g.title,style:{backgroundColor:null!==(P=N?.nodes?.[i?.type]?.title?.background)&&void 0!==P?P:N?.nodes?.common?.title?.background,color:null!==(M=N?.nodes?.[i?.type]?.title?.color)&&void 0!==M?M:N?.nodes?.common?.title?.color},children:n.jsx("h3",{style:{textAlign:"center"},children:b?E:t})}),n.jsxs("div",{className:g.container,children:[n.jsx("div",{className:[g.portsContainer,g.inputPortsContainer].join(" "),children:L?.map((e=>{const t=o[e.type],i=null!=e.hidePort?e.hidePort:t.hidePort;return n.jsx(x,{name:e.name,value:j[e.name],onValueChange:n=>{h?.({...r,values:{...r.values,[e.name]:n}})},nodeId:E,type:o[e.type],direction:"input",label:e.label,hidePort:Boolean(i),containerRef:f,isConnected:r.connections?.inputs?.some((n=>n.name===e.name)),onConnected:I,canMove:s,options:e.options},e.name)}))}),n.jsx("div",{className:[g.portsContainer,g.outputPortsContainer].join(" "),children:Y?.map((e=>n.jsx(x,{name:e.name,nodeId:E,type:o[e.type],direction:"output",label:e.label,containerRef:f,isConnected:r.connections?.outputs?.some((n=>n.name===e.name)),onConnected:O,canMove:s,options:e.options},e.name)))})]})]},`card-${E}`)}var C=e.memo(b),w=function(e,n){return Number(e.toFixed(n))},S=function(e,n,t){t&&"function"==typeof t&&t(e,n)},P={easeOut:function(e){return-Math.cos(e*Math.PI)/2+.5},linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},M=function(e){"number"==typeof e&&cancelAnimationFrame(e)},N=function(e){e.mounted&&(M(e.animation),e.animate=!1,e.animation=null,e.velocity=null)};function T(e,n,t,o){if(e.mounted){var i=(new Date).getTime();N(e),e.animation=function(){if(!e.mounted)return M(e.animation);var r=(new Date).getTime()-i,s=r/t,a=(0,P[n])(s);r>=t?(o(1),e.animation=null):e.animation&&(o(a),requestAnimationFrame(e.animation))},requestAnimationFrame(e.animation)}}function E(e,n,t,o){var i=function(e){var n=e.scale,t=e.positionX,o=e.positionY;return!(Number.isNaN(n)||Number.isNaN(t)||Number.isNaN(o))}(n);if(e.mounted&&i){var r=e.setTransformState,s=e.transformState,a=s.scale,l=s.positionX,c=s.positionY,u=n.scale-a,d=n.positionX-l,p=n.positionY-c;0===t?r(n.scale,n.positionX,n.positionY):T(e,o,t,(function(e){r(a+u*e,l+d*e,c+p*e)}))}}var H=function(e,n){var t=e.wrapperComponent,o=e.contentComponent,i=e.setup.centerZoomedOut;if(!t||!o)throw new Error("Components are not mounted");var r=function(e,n,t){var o=e.offsetWidth,i=e.offsetHeight,r=n.offsetWidth*t,s=n.offsetHeight*t;return{wrapperWidth:o,wrapperHeight:i,newContentWidth:r,newDiffWidth:o-r,newContentHeight:s,newDiffHeight:i-s}}(t,o,n),s=r.wrapperWidth,a=r.wrapperHeight,l=function(e,n,t,o,i,r,s){var a=e>n?t*(s?1:.5):0,l=o>i?r*(s?1:.5):0;return{minPositionX:e-n-a,maxPositionX:a,minPositionY:o-i-l,maxPositionY:l}}(s,r.newContentWidth,r.newDiffWidth,a,r.newContentHeight,r.newDiffHeight,Boolean(i));return l},V=function(e,n,t,o){return w(o?e<n?n:e>t?t:e:e,2)},j=function(e,n){var t=H(e,n);return e.bounds=t,t};function _(e,n,t,o,i,r,s){var a=t.minPositionX,l=t.minPositionY,c=t.maxPositionX,u=t.maxPositionY,d=0,p=0;return s&&(d=i,p=r),{x:V(e,a-d,c+d,o),y:V(n,l-p,u+p,o)}}function k(e,n,t,o,i,r){var s=e.transformState,a=s.scale,l=s.positionX,c=s.positionY,u=o-a;return"number"!=typeof n||"number"!=typeof t?(console.error("Mouse X and Y position were not provided!"),{x:l,y:c}):_(l-n*u,c-t*u,i,r,0,0,null)}function O(e,n,t,o,i){var r=n-(i?o:0);return!Number.isNaN(t)&&e>=t?t:!Number.isNaN(n)&&e<=r?r:e}var I=function(e,n){var t=e.setup.panning.excluded,o=e.isInitialized,i=e.wrapperComponent,r=n.target,s=null==i?void 0:i.contains(r);return!!(o&&r&&s)&&!fe(r,t)},L=function(e){var n=e.isInitialized,t=e.isPanning,o=e.setup.panning.disabled;return!(!n||!t||o)};var Y=function(e,n){var t=e.setup,o=e.transformState.scale,i=t.minScale,r=t.disablePadding;return n>0&&o>=i&&!r?n:0},z=function(e){var n=e.mounted,t=e.setup,o=t.disabled,i=t.velocityAnimation,r=e.transformState.scale;return!(i.disabled&&!(r>1)&&o&&!n)},A=function(e){var n=e.mounted,t=e.velocity,o=e.bounds,i=e.setup,r=i.disabled,s=i.velocityAnimation,a=e.transformState.scale;return!(s.disabled&&!(a>1)&&r&&!n)&&!(!t||!o)};function R(e,n,t,o,i,r,s,a,l,c){if(i){var u;if(n>s&&t>s)return(u=s+(e-s)*c)>l?l:u<s?s:u;if(n<r&&t<r)return(u=r+(e-r)*c)<a?a:u>r?r:u}return o?n:V(e,r,s,i)}function X(e,n){if(z(e)){var t=e.lastMousePosition,o=e.velocityTime,i=e.setup,r=e.wrapperComponent,s=i.velocityAnimation.equalToMove,a=Date.now();if(t&&o&&r){var l=function(e,n){return n?Math.min(1,e.offsetWidth/window.innerWidth):1}(r,s),c=n.x-t.x,u=n.y-t.y,d=c/l,p=u/l,f=a-o,m=c*c+u*u,y=Math.sqrt(m)/f;e.velocity={velocityX:d,velocityY:p,total:y}}e.lastMousePosition=n,e.velocityTime=a}}function W(e,n){var t=e.transformState.scale;N(e),j(e,t),void 0!==window.TouchEvent&&n instanceof TouchEvent?function(e,n){var t=n.touches,o=e.transformState,i=o.positionX,r=o.positionY;if(e.isPanning=!0,1===t.length){var s=t[0].clientX,a=t[0].clientY;e.startCoords={x:s-i,y:a-r}}}(e,n):function(e,n){var t=e.transformState,o=t.positionX,i=t.positionY;e.isPanning=!0;var r=n.clientX,s=n.clientY;e.startCoords={x:r-o,y:s-i}}(e,n)}function $(e){var n=e.transformState.scale,t=e.setup,o=t.minScale,i=t.alignmentAnimation,r=i.disabled,s=i.sizeX,a=i.sizeY,l=i.animationTime,c=i.animationType;if(!(r||n<o||!s&&!a)){var u=function(e){var n=e.transformState,t=n.positionX,o=n.positionY,i=n.scale,r=e.setup,s=r.disabled,a=r.limitToBounds,l=r.centerZoomedOut,c=e.wrapperComponent;if(!s&&c&&e.bounds){var u=e.bounds,d=u.maxPositionX,p=u.minPositionX,f=u.maxPositionY,m=u.minPositionY,y=t>d||t<p,v=o>f||o<m,h=k(e,t>d?c.offsetWidth:e.setup.minPositionX||0,o>f?c.offsetHeight:e.setup.minPositionY||0,i,e.bounds,a||l),x=h.x,g=h.y;return{scale:i,positionX:y?x:t,positionY:v?g:o}}}(e);u&&E(e,u,l,c)}}function B(e,n,t){var o=e.startCoords,i=e.setup.alignmentAnimation,r=i.sizeX,s=i.sizeY;if(o){var a=function(e,n,t){var o=e.startCoords,i=e.transformState,r=e.setup.panning,s=r.lockAxisX,a=r.lockAxisY,l=i.positionX,c=i.positionY;if(!o)return{x:l,y:c};var u=n-o.x,d=t-o.y;return{x:s?l:u,y:a?c:d}}(e,n,t),l=a.x,c=a.y,u=Y(e,r),d=Y(e,s);X(e,{x:l,y:c}),function(e,n,t,o,i){var r=e.setup.limitToBounds,s=e.wrapperComponent,a=e.bounds,l=e.transformState,c=l.scale,u=l.positionX,d=l.positionY;if(null!==s&&null!==a&&(n!==u||t!==d)){var p=_(n,t,a,r,o,i,s),f=p.x,m=p.y;e.setTransformState(c,f,m)}}(e,l,c,u,d)}}function D(e){if(e.isPanning){var n=e.setup.panning.velocityDisabled,t=e.velocity,o=e.wrapperComponent,i=e.contentComponent;e.isPanning=!1,e.animate=!1,e.animation=null;var r=null==o?void 0:o.getBoundingClientRect(),s=null==i?void 0:i.getBoundingClientRect(),a=(null==r?void 0:r.width)||0,l=(null==r?void 0:r.height)||0,c=(null==s?void 0:s.width)||0,u=(null==s?void 0:s.height)||0,d=a<c||l<u;!n&&t&&(null==t?void 0:t.total)>.1&&d?function(e){var n=e.velocity,t=e.bounds,o=e.setup,i=e.wrapperComponent;if(A(e)&&n&&t&&i){var r=n.velocityX,s=n.velocityY,a=n.total,l=t.maxPositionX,c=t.minPositionX,u=t.maxPositionY,d=t.minPositionY,p=o.limitToBounds,f=o.alignmentAnimation,m=o.zoomAnimation,y=o.panning,v=y.lockAxisY,h=y.lockAxisX,x=m.animationType,g=f.sizeX,b=f.sizeY,C=f.velocityAlignmentTime,w=function(e,n){var t=e.setup.velocityAnimation,o=t.equalToMove,i=t.animationTime,r=t.sensitivity;return o?i*n*r:i}(e,a),S=Math.max(w,C),M=Y(e,g),N=Y(e,b),E=M*i.offsetWidth/100,H=N*i.offsetHeight/100,V=l+E,j=c-E,_=u+H,k=d-H,O=e.transformState,I=(new Date).getTime();T(e,x,S,(function(n){var t=e.transformState,o=t.scale,i=t.positionX,a=t.positionY,m=((new Date).getTime()-I)/C,y=1-(0,P[f.animationType])(Math.min(1,m)),x=1-n,g=i+r*x,b=a+s*x,w=R(g,O.positionX,i,h,p,c,l,j,V,y),S=R(b,O.positionY,a,v,p,d,u,k,_,y);i===g&&a===b||e.setTransformState(o,w,S)}))}}(e):$(e)}}function F(e,n,t,o){var i=e.setup,r=i.minScale,s=i.maxScale,a=i.limitToBounds,l=O(w(n,2),r,s,0,!1),c=k(e,t,o,l,j(e,l),a);return{scale:l,positionX:c.x,positionY:c.y}}function Z(e,n,t){var o=e.transformState.scale,i=e.wrapperComponent,r=e.setup,s=r.minScale,a=r.limitToBounds,l=r.zoomAnimation,c=l.disabled,u=l.animationTime,d=l.animationType,p=c||o>=s;if((o>=1||a)&&$(e),!p&&i&&e.mounted){var f=F(e,s,n||i.offsetWidth/2,t||i.offsetHeight/2);f&&E(e,f,u,d)}}var q=function(){return q=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},q.apply(this,arguments)};function K(e,n,t){if(t||2===arguments.length)for(var o,i=0,r=n.length;i<r;i++)!o&&i in n||(o||(o=Array.prototype.slice.call(n,0,i)),o[i]=n[i]);return e.concat(o||Array.prototype.slice.call(n))}var J=1,U=0,Q=0,G={disabled:!1,minPositionX:null,maxPositionX:null,minPositionY:null,maxPositionY:null,minScale:1,maxScale:8,limitToBounds:!0,centerZoomedOut:!1,centerOnInit:!1,disablePadding:!1,wheel:{step:.2,disabled:!1,wheelDisabled:!1,touchPadDisabled:!1,activationKeys:[],excluded:[]},panning:{disabled:!1,velocityDisabled:!1,lockAxisX:!1,lockAxisY:!1,activationKeys:[],excluded:[]},pinch:{step:5,disabled:!1,excluded:[]},doubleClick:{disabled:!1,step:.7,mode:"zoomIn",animationType:"easeOut",animationTime:200,excluded:[]},zoomAnimation:{disabled:!1,size:.4,animationTime:200,animationType:"easeOut"},alignmentAnimation:{disabled:!1,sizeX:100,sizeY:100,animationTime:200,velocityAlignmentTime:400,animationType:"easeOut"},velocityAnimation:{disabled:!1,sensitivity:1,animationTime:400,animationType:"easeOut",equalToMove:!0}},ee=function(e){var n,t,o,i;return{previousScale:null!==(n=e.initialScale)&&void 0!==n?n:J,scale:null!==(t=e.initialScale)&&void 0!==t?t:J,positionX:null!==(o=e.initialPositionX)&&void 0!==o?o:U,positionY:null!==(i=e.initialPositionY)&&void 0!==i?i:Q}},ne=function(e){var n=q({},G);return Object.keys(e).forEach((function(t){var o=void 0!==e[t];if(void 0!==G[t]&&o){var i=Object.prototype.toString.call(G[t]),r="[object Object]"===i,s="[object Array]"===i;n[t]=r?q(q({},G[t]),e[t]):s?K(K([],G[t],!0),e[t],!0):e[t]}})),n},te=function(e,n,t){var o=e.transformState.scale,i=e.wrapperComponent,r=e.setup,s=r.maxScale,a=r.minScale,l=r.zoomAnimation.size;if(!i)throw new Error("Wrapper is not mounted");var c=o*Math.exp(n*t);return O(w(c,3),a,s,l,!1)};function oe(e,n,t,o,i){var r=e.wrapperComponent,s=e.transformState,a=s.scale,l=s.positionX,c=s.positionY;if(!r)return console.error("No WrapperComponent found");var u=(r.offsetWidth/2-l)/a,d=(r.offsetHeight/2-c)/a,p=F(e,te(e,n,t),u,d);if(!p)return console.error("Error during zoom event. New transformation state was not calculated.");E(e,p,o,i)}function ie(e,n,t,o){var i=e.setup,r=e.wrapperComponent,s=i.limitToBounds,a=ee(e.props),l=e.transformState,c=l.scale,u=l.positionX,d=l.positionY;if(r){var p=H(e,a.scale),f=_(a.positionX,a.positionY,p,s,0,0,r),m={scale:a.scale,positionX:f.x,positionY:f.y};c===a.scale&&u===a.positionX&&d===a.positionY||(null==o||o(),E(e,m,n,t))}}var re=function(e){return function(n,t,o){void 0===n&&(n=.5),void 0===t&&(t=300),void 0===o&&(o="easeOut"),oe(e,1,n,t,o)}},se=function(e){return function(n,t,o){void 0===n&&(n=.5),void 0===t&&(t=300),void 0===o&&(o="easeOut"),oe(e,-1,n,t,o)}},ae=function(e){return function(n,t,o,i,r){void 0===i&&(i=300),void 0===r&&(r="easeOut");var s=e.transformState,a=s.positionX,l=s.positionY,c=s.scale,u=e.wrapperComponent,d=e.contentComponent;if(!e.setup.disabled&&u&&d){var p={positionX:Number.isNaN(n)?a:n,positionY:Number.isNaN(t)?l:t,scale:Number.isNaN(o)?c:o};E(e,p,i,r)}}},le=function(e){return function(n,t){void 0===n&&(n=200),void 0===t&&(t="easeOut"),ie(e,n,t)}},ce=function(e){return function(n,t,o){void 0===t&&(t=200),void 0===o&&(o="easeOut");var i=e.transformState,r=e.wrapperComponent,s=e.contentComponent;if(r&&s){var a=ye(n||i.scale,r,s);E(e,a,t,o)}}},ue=function(e){return function(n,t,o,i){void 0===o&&(o=600),void 0===i&&(i="easeOut"),N(e);var r=e.wrapperComponent,s="string"==typeof n?document.getElementById(n):n;if(r&&s&&r.contains(s)){var a=function(e,n,t){var o=e.wrapperComponent,i=e.contentComponent,r=e.transformState,s=e.setup,a=s.limitToBounds,l=s.minScale,c=s.maxScale;if(!o||!i)return r;var u,d,p,f,m,y,v,h,x=o.getBoundingClientRect(),g=n.getBoundingClientRect(),b=(u=o,d=i,p=r,f=n.getBoundingClientRect(),m=u.getBoundingClientRect(),y=d.getBoundingClientRect(),v=m.x*p.scale,h=m.y*p.scale,{x:(f.x-y.x+v)/p.scale,y:(f.y-y.y+h)/p.scale}),C=b.x,w=b.y,S=g.width/r.scale,P=g.height/r.scale,M=o.offsetWidth/S,N=o.offsetHeight/P,T=O(t||Math.min(M,N),l,c,0,!1),E=(x.width-S*T)/2,V=(x.height-P*T)/2,j=_((x.left-C)*T+E,(x.top-w)*T+V,H(e,T),a,0,0,o);return{positionX:j.x,positionY:j.y,scale:T}}(e,s,t);E(e,a,o,i)}}},de=function(e){return{instance:e,state:e.transformState,zoomIn:re(e),zoomOut:se(e),setTransform:ae(e),resetTransform:le(e),centerView:ce(e),zoomToElement:ue(e)}};function pe(){try{return{get passive(){return!0,!1}}}catch(e){return!1}}var fe=function(e,n){var t=e.tagName.toUpperCase();return!!n.find((function(e){return e.toUpperCase()===t}))||!!n.find((function(n){return e.classList.contains(n)}))},me=function(e){e&&clearTimeout(e)},ye=function(e,n,t){var o=t.offsetWidth*e,i=t.offsetHeight*e;return{scale:e,positionX:(n.offsetWidth-o)/2,positionY:(n.offsetHeight-i)/2}};function ve(e,n,t){var o=n.getBoundingClientRect(),i=0,r=0;if("clientX"in e)i=(e.clientX-o.left)/t,r=(e.clientY-o.top)/t;else{var s=e.touches[0];i=(s.clientX-o.left)/t,r=(s.clientY-o.top)/t}return(Number.isNaN(i)||Number.isNaN(r))&&console.error("No mouse or touch offset found"),{x:i,y:r}}var he=function(e){return Math.sqrt(Math.pow(e.touches[0].pageX-e.touches[1].pageX,2)+Math.pow(e.touches[0].pageY-e.touches[1].pageY,2))},xe=function(e,n){var t=e.props,o=t.onWheel,i=t.onZoom,r=e.contentComponent,s=e.setup,a=e.transformState.scale,l=s.limitToBounds,c=s.centerZoomedOut,u=s.zoomAnimation,d=s.wheel,p=s.disablePadding,f=u.size,m=u.disabled,y=d.step;if(!r)throw new Error("Component not mounted");n.preventDefault(),n.stopPropagation();var v=function(e,n){var t,o,i=function(e){return e?e.deltaY<0?1:-1:0}(e);return o=i,"number"==typeof(t=n)?t:o}(n,null),h=function(e,n,t,o,i){var r=e.transformState.scale,s=e.wrapperComponent,a=e.setup,l=a.maxScale,c=a.minScale,u=a.zoomAnimation,d=a.disablePadding,p=u.size,f=u.disabled;if(!s)throw new Error("Wrapper is not mounted");var m=r+n*(r-r*t)*t;if(i)return m;var y=!o&&!f;return O(w(m,3),c,l,p,y&&!d)}(e,v,y,!n.ctrlKey);if(a!==h){var x=j(e,h),g=ve(n,r,a),b=l&&(m||0===f||c||p),C=k(e,g.x,g.y,h,x,b),P=C.x,M=C.y;e.previousWheelEvent=n,e.setTransformState(h,P,M),S(de(e),n,o),S(de(e),n,i)}},ge=function(e,n){var t=e.props,o=t.onWheelStop,i=t.onZoomStop;me(e.wheelAnimationTimer),e.wheelAnimationTimer=setTimeout((function(){e.mounted&&(Z(e,n.x,n.y),e.wheelAnimationTimer=null)}),100);var r=function(e,n){var t=e.previousWheelEvent,o=e.transformState.scale,i=e.setup,r=i.maxScale,s=i.minScale;return!!t&&(o<r||o>s||Math.sign(t.deltaY)!==Math.sign(n.deltaY)||t.deltaY>0&&t.deltaY<n.deltaY||t.deltaY<0&&t.deltaY>n.deltaY||Math.sign(t.deltaY)!==Math.sign(n.deltaY))}(e,n);r&&(me(e.wheelStopEventTimer),e.wheelStopEventTimer=setTimeout((function(){e.mounted&&(e.wheelStopEventTimer=null,S(de(e),n,o),S(de(e),n,i))}),160))},be=function(e,n){var t=e.contentComponent,o=e.pinchStartDistance,i=e.transformState.scale,r=e.setup,s=r.limitToBounds,a=r.centerZoomedOut,l=r.zoomAnimation,c=l.disabled,u=l.size;if(null!==o&&t){var d=function(e,n,t){var o=t.getBoundingClientRect(),i=e.touches,r=w(i[0].clientX-o.left,5),s=w(i[0].clientY-o.top,5);return{x:(r+w(i[1].clientX-o.left,5))/2/n,y:(s+w(i[1].clientY-o.top,5))/2/n}}(n,i,t);if(Number.isFinite(d.x)&&Number.isFinite(d.y)){var p=he(n),f=function(e,n){var t=e.pinchStartScale,o=e.pinchStartDistance,i=e.setup,r=i.maxScale,s=i.minScale,a=i.zoomAnimation,l=i.disablePadding,c=a.size,u=a.disabled;if(!t||null===o||!n)throw new Error("Pinch touches distance was not provided");return n<0?e.transformState.scale:O(w(n/o*t,2),s,r,c,!u&&!l)}(e,p);if(f!==i){var m=j(e,f),y=s&&(c||0===u||a),v=k(e,d.x,d.y,f,m,y),h=v.x,x=v.y;e.pinchMidpoint=d,e.lastDistance=p,e.setTransformState(f,h,x)}}}},Ce=function(e,n){var t=e.props.onZoomStop,o=e.setup.doubleClick.animationTime;me(e.doubleClickStopEventTimer),e.doubleClickStopEventTimer=setTimeout((function(){e.doubleClickStopEventTimer=null,S(de(e),n,t)}),o)};function we(e,n){var t=e.setup,o=e.doubleClickStopEventTimer,i=e.transformState,r=e.contentComponent,s=i.scale,a=e.props,l=a.onZoomStart,c=a.onZoom,u=t.doubleClick,d=u.disabled,p=u.mode,f=u.step,m=u.animationTime,y=u.animationType;if(!d&&!o){if("reset"===p)return function(e,n){var t=e.props,o=t.onZoomStart,i=t.onZoom,r=e.setup.doubleClick,s=r.animationTime,a=r.animationType;S(de(e),n,o),ie(e,s,a,(function(){return S(de(e),n,i)})),Ce(e,n)}(e,n);if(!r)return console.error("No ContentComponent found");var v=te(e,"zoomOut"===p?-1:1,f);if(s!==v){S(de(e),n,l);var h=ve(n,r,s),x=F(e,v,h.x,h.y);if(!x)return console.error("Error during zoom event. New transformation state was not calculated.");S(de(e),n,c),E(e,x,m,y),Ce(e,n)}}}var Se=function(e){var n=this;this.mounted=!0,this.onChangeCallbacks=new Set,this.wrapperComponent=null,this.contentComponent=null,this.isInitialized=!1,this.bounds=null,this.previousWheelEvent=null,this.wheelStopEventTimer=null,this.wheelAnimationTimer=null,this.isPanning=!1,this.startCoords=null,this.lastTouch=null,this.distance=null,this.lastDistance=null,this.pinchStartDistance=null,this.pinchStartScale=null,this.pinchMidpoint=null,this.doubleClickStopEventTimer=null,this.velocity=null,this.velocityTime=null,this.lastMousePosition=null,this.animate=!1,this.animation=null,this.maxBounds=null,this.pressedKeys={},this.mount=function(){n.initializeWindowEvents()},this.unmount=function(){n.cleanupWindowEvents()},this.update=function(e){j(n,n.transformState.scale),n.setup=ne(e)},this.initializeWindowEvents=function(){var e,t=pe(),o=null===(e=n.wrapperComponent)||void 0===e?void 0:e.ownerDocument,i=null==o?void 0:o.defaultView;null==i||i.addEventListener("mousedown",n.onPanningStart,t),null==i||i.addEventListener("mousemove",n.onPanning,t),null==i||i.addEventListener("mouseup",n.onPanningStop,t),null==o||o.addEventListener("mouseleave",n.clearPanning,t),null==i||i.addEventListener("keyup",n.setKeyUnPressed,t),null==i||i.addEventListener("keydown",n.setKeyPressed,t)},this.cleanupWindowEvents=function(){var e,t,o=pe(),i=null===(e=n.wrapperComponent)||void 0===e?void 0:e.ownerDocument,r=null==i?void 0:i.defaultView;null==r||r.removeEventListener("mousedown",n.onPanningStart,o),null==r||r.removeEventListener("mousemove",n.onPanning,o),null==r||r.removeEventListener("mouseup",n.onPanningStop,o),null==i||i.removeEventListener("mouseleave",n.clearPanning,o),null==r||r.removeEventListener("keyup",n.setKeyUnPressed,o),null==r||r.removeEventListener("keydown",n.setKeyPressed,o),document.removeEventListener("mouseleave",n.clearPanning,o),N(n),null===(t=n.observer)||void 0===t||t.disconnect()},this.handleInitializeWrapperEvents=function(e){var t=pe();e.addEventListener("wheel",n.onWheelZoom,t),e.addEventListener("dblclick",n.onDoubleClick,t),e.addEventListener("touchstart",n.onTouchPanningStart,t),e.addEventListener("touchmove",n.onTouchPanning,t),e.addEventListener("touchend",n.onTouchPanningStop,t)},this.handleInitialize=function(e){var t=n.setup.centerOnInit;n.applyTransformation(),t&&(n.setCenter(),n.observer=new ResizeObserver((function(){var e;n.setCenter(),null===(e=n.observer)||void 0===e||e.disconnect()})),n.observer.observe(e))},this.onWheelZoom=function(e){if(!n.setup.disabled){var t=function(e,n){var t=e.setup.wheel,o=t.disabled,i=t.wheelDisabled,r=t.touchPadDisabled,s=t.excluded,a=e.isInitialized,l=e.isPanning,c=n.target;return!(!a||l||o||!c||i&&!n.ctrlKey||r&&n.ctrlKey||fe(c,s))}(n,e);t&&n.isPressingKeys(n.setup.wheel.activationKeys)&&(function(e,n){var t=e.props,o=t.onWheelStart,i=t.onZoomStart;e.wheelStopEventTimer||(N(e),S(de(e),n,o),S(de(e),n,i))}(n,e),xe(n,e),ge(n,e))}},this.onPanningStart=function(e){var t=n.setup.disabled,o=n.props.onPanningStart;t||I(n,e)&&n.isPressingKeys(n.setup.panning.activationKeys)&&(e.preventDefault(),e.stopPropagation(),N(n),W(n,e),S(de(n),e,o))},this.onPanning=function(e){var t=n.setup.disabled,o=n.props.onPanning;t||L(n)&&n.isPressingKeys(n.setup.panning.activationKeys)&&(e.preventDefault(),e.stopPropagation(),B(n,e.clientX,e.clientY),S(de(n),e,o))},this.onPanningStop=function(e){var t=n.props.onPanningStop;n.isPanning&&(D(n),S(de(n),e,t))},this.onPinchStart=function(e){var t=n.setup.disabled,o=n.props,i=o.onPinchingStart,r=o.onZoomStart;if(!t){var s=function(e,n){var t=e.setup.pinch,o=t.disabled,i=t.excluded,r=e.isInitialized,s=n.target;return!(!r||o||!s||fe(s,i))}(n,e);s&&(function(e,n){var t=he(n);e.pinchStartDistance=t,e.lastDistance=t,e.pinchStartScale=e.transformState.scale,e.isPanning=!1,N(e)}(n,e),N(n),S(de(n),e,i),S(de(n),e,r))}},this.onPinch=function(e){var t=n.setup.disabled,o=n.props,i=o.onPinching,r=o.onZoom;if(!t){var s=function(e){var n=e.setup.pinch.disabled,t=e.isInitialized,o=e.pinchStartDistance;return!(!t||n||!o)}(n);s&&(e.preventDefault(),e.stopPropagation(),be(n,e),S(de(n),e,i),S(de(n),e,r))}},this.onPinchStop=function(e){var t,o,i=n.props,r=i.onPinchingStop,s=i.onZoomStop;n.pinchStartScale&&(o=(t=n).pinchMidpoint,t.velocity=null,t.lastDistance=null,t.pinchMidpoint=null,t.pinchStartScale=null,t.pinchStartDistance=null,Z(t,null==o?void 0:o.x,null==o?void 0:o.y),S(de(n),e,r),S(de(n),e,s))},this.onTouchPanningStart=function(e){var t=n.setup.disabled,o=n.props.onPanningStart;if(!t&&I(n,e))if(n.lastTouch&&+new Date-n.lastTouch<200&&1===e.touches.length)n.onDoubleClick(e);else{n.lastTouch=+new Date,N(n);var i=e.touches,r=1===i.length,s=2===i.length;r&&(N(n),W(n,e),S(de(n),e,o)),s&&n.onPinchStart(e)}},this.onTouchPanning=function(e){var t=n.setup.disabled,o=n.props.onPanning;if(n.isPanning&&1===e.touches.length){if(t)return;if(!L(n))return;e.preventDefault(),e.stopPropagation();var i=e.touches[0];B(n,i.clientX,i.clientY),S(de(n),e,o)}else e.touches.length>1&&n.onPinch(e)},this.onTouchPanningStop=function(e){n.onPanningStop(e),n.onPinchStop(e)},this.onDoubleClick=function(e){if(!n.setup.disabled){var t=function(e,n){var t=e.isInitialized,o=e.setup,i=e.wrapperComponent,r=o.doubleClick,s=r.disabled,a=r.excluded,l=n.target,c=null==i?void 0:i.contains(l);return!(!(t&&l&&c)||s||fe(l,a))}(n,e);t&&we(n,e)}},this.clearPanning=function(e){n.isPanning&&n.onPanningStop(e)},this.setKeyPressed=function(e){n.pressedKeys[e.key]=!0},this.setKeyUnPressed=function(e){n.pressedKeys[e.key]=!1},this.isPressingKeys=function(e){return!e.length||Boolean(e.find((function(e){return n.pressedKeys[e]})))},this.setTransformState=function(e,t,o){var i=n.props.onTransformed;if(Number.isNaN(e)||Number.isNaN(t)||Number.isNaN(o))console.error("Detected NaN set state values");else{e!==n.transformState.scale&&(n.transformState.previousScale=n.transformState.scale,n.transformState.scale=e),n.transformState.positionX=t,n.transformState.positionY=o;var r=de(n);n.onChangeCallbacks.forEach((function(e){return e(r)})),S(r,{scale:e,positionX:t,positionY:o},i),n.applyTransformation()}},this.setCenter=function(){if(n.wrapperComponent&&n.contentComponent){var e=ye(n.transformState.scale,n.wrapperComponent,n.contentComponent);n.setTransformState(e.scale,e.positionX,e.positionY)}},this.handleTransformStyles=function(e,t,o){return n.props.customTransform?n.props.customTransform(e,t,o):function(e,n,t){return"translate(".concat(e,"px, ").concat(n,"px) scale(").concat(t,")")}(e,t,o)},this.applyTransformation=function(){if(n.mounted&&n.contentComponent){var e=n.transformState,t=e.scale,o=e.positionX,i=e.positionY,r=n.handleTransformStyles(o,i,t);n.contentComponent.style.transform=r}},this.getContext=function(){return de(n)},this.onChange=function(e){return n.onChangeCallbacks.has(e)||n.onChangeCallbacks.add(e),function(){n.onChangeCallbacks.delete(e)}},this.init=function(e,t){n.cleanupWindowEvents(),n.wrapperComponent=e,n.contentComponent=t,j(n,n.transformState.scale),n.handleInitializeWrapperEvents(e),n.handleInitialize(t),n.initializeWindowEvents(),n.isInitialized=!0,S(de(n),void 0,n.props.onInit)},this.props=e,this.setup=ne(this.props),this.transformState=ee(this.props)},Pe=e.createContext(null),Me=e.forwardRef((function(n,t){var o=e.useState(0)[1],i=n.children,r=e.useRef(new Se(n)).current,s=function(e,n){return"function"==typeof e?e(n):e}(n.children,de(r)),a=e.useCallback((function(){"function"==typeof i&&o((function(e){return e+1}))}),[i]);return e.useImperativeHandle(t,(function(){return de(r)}),[r]),e.useEffect((function(){r.update(n)}),[r,n]),e.useEffect((function(){return r.onChange(a)}),[r,n,a]),e.createElement(Pe.Provider,{value:r},s)}));var Ne="transform-component-module_wrapper__7HFJe",Te="transform-component-module_content__uCDPE";!function(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===t&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".transform-component-module_wrapper__7HFJe {\n  position: relative;\n  width: -moz-fit-content;\n  width: fit-content;\n  height: -moz-fit-content;\n  height: fit-content;\n  overflow: hidden;\n  -webkit-touch-callout: none; /* iOS Safari */\n  -webkit-user-select: none; /* Safari */\n  -khtml-user-select: none; /* Konqueror HTML */\n  -moz-user-select: none; /* Firefox */\n  -ms-user-select: none; /* Internet Explorer/Edge */\n  user-select: none;\n  margin: 0;\n  padding: 0;\n}\n.transform-component-module_content__uCDPE {\n  display: flex;\n  flex-wrap: wrap;\n  width: -moz-fit-content;\n  width: fit-content;\n  height: -moz-fit-content;\n  height: fit-content;\n  margin: 0;\n  padding: 0;\n  transform-origin: 0% 0%;\n}\n.transform-component-module_content__uCDPE img {\n  pointer-events: none;\n}\n");var Ee=function(n){var t=n.children,o=n.wrapperClass,i=void 0===o?"":o,r=n.contentClass,s=void 0===r?"":r,a=n.wrapperStyle,l=n.contentStyle,c=n.wrapperProps,u=void 0===c?{}:c,d=n.contentProps,p=void 0===d?{}:d,f=e.useContext(Pe).init,m=e.useRef(null),y=e.useRef(null);return e.useEffect((function(){var e=m.current,n=y.current;null!==e&&null!==n&&f&&f(e,n)}),[]),e.createElement("div",q({},u,{ref:m,className:"react-transform-wrapper ".concat(Ne," ").concat(i),style:a}),e.createElement("div",q({},p,{ref:y,className:"react-transform-component ".concat(Te," ").concat(s),style:l}),t))};e.forwardRef((function(n,t){var o,i=e.useRef(null),r=e.useContext(Pe);return e.useEffect((function(){return r.onChange((function(e){if(i.current){i.current.style.transform=r.handleTransformStyles(0,0,1/e.state.scale)}}))}),[r]),e.createElement("div",q({},n,{ref:(o=[i,t],function(e){o.forEach((function(n){"function"==typeof n?n(e):null!=n&&(n.current=e)}))})}))}));var He={container:"ConnectorCurve-module_container__pqaPv",path:"ConnectorCurve-module_path__CjFPJ",pathTmp:"ConnectorCurve-module_pathTmp__g4cyl",waypoint:"ConnectorCurve-module_waypoint__YhVmn",selected:"ConnectorCurve-module_selected__9zOuy",invalid:"ConnectorCurve-module_invalid__ar5Fy",destroy:"ConnectorCurve-module_destroy__qyMSc"};function Ve({type:t,src:o,dst:i,scale:r,tmp:s,invalid:l,onContextMenu:c,waypoints:u=[],onWaypointContextMenu:d,onUpdateWaypoint:p,onWaypointMouseDown:f,isWaypointSelected:m}){var v,h,x;const{currentTheme:g}=y(),{scale:b}=a(),[C,w]=e.useState(!1),[S,P]=e.useState(-1),[M,N]=e.useState(!1);if(!o||!i)return;const T={x:o.x<i.x?5:5-(i.x-o.x),y:o.y<i.y?5:5-(i.y-o.y)},E={x:o.x<i.x?i.x-o.x+5:5,y:o.y<i.y?i.y-o.y+5:5},H=50;let V=Math.min(o.x,i.x),j=Math.min(o.y,i.y),_=Math.max(o.x,i.x),k=Math.max(o.y,i.y);const O=u.map((e=>({...e,originalX:e.x,originalY:e.y,x:e.x-V,y:e.y-j}))),I=E.x>T.x?Math.abs(E.x-T.x)/2:T.x-E.x<150?T.x+(T.x-E.x):T.x+150+(T.x-E.x)/7,L=T.y,Y=E.x>T.x?Math.abs(E.x-T.x)/2:T.x-E.x<150?E.x+(E.x-T.x):E.x-150-(T.x-E.x)/7,z=E.y;let A=`M ${T.x+H} ${T.y+H}`;if(0===u.length)A+=` C ${I+H} ${L+H}, ${Y+H} ${z+H}, ${E.x+H} ${E.y+H}`;else{const e=[{x:T.x,y:T.y},...O,{x:E.x,y:E.y}];for(let n=0;n<e.length-1;n++){const t=e[n],o=e[n+1],i={x:t.x+(o.x-t.x)/2,y:t.y},r={x:t.x+(o.x-t.x)/2,y:o.y};A+=` C ${i.x+H} ${i.y+H}, ${r.x+H} ${r.y+H}, ${o.x+H} ${o.y+H}`}}return n.jsxs("svg",{style:{transform:`translate(${V-H}px, ${j-H}px)`,width:_-V+100,height:k-j+100,zIndex:s?1e3:-1,overflow:"visible"},className:[He.container,l?He.invalid:null].join(" "),children:[n.jsx("path",{style:{stroke:null!==(v=null!==(h=null!==(x=g.connections?.[t?.type]?.color)&&void 0!==x?x:t?.color)&&void 0!==h?h:g.connections?.default?.color)&&void 0!==v?v:"#ccc",strokeWidth:C?Math.max(10,10*r):Math.max(4,5*r)},className:[He.path,s?He.pathTmp:null].filter(Boolean).join(" "),d:A,onContextMenu:c,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1)}),O.map(((e,o)=>{var i,s,a,l,c,y;const v=m&&m(o),h=S===o||M&&S===o||v?Math.max(10,10*r):Math.max(6,6*r);return n.jsx("circle",{cx:e.x+H,cy:e.y+H,r:h,stroke:null!==(i=null!==(s=null!==(a=g.connections?.[t?.type]?.color)&&void 0!==a?a:t?.color)&&void 0!==s?s:g.connections?.default?.color)&&void 0!==i?i:"#ccc",fill:null!==(l=null!==(c=null!==(y=g.connections?.[t?.type]?.color)&&void 0!==y?y:t?.color)&&void 0!==c?c:g.connections?.default?.color)&&void 0!==l?l:"#ccc",strokeWidth:v?Math.max(3,3*r):Math.max(2,2*r),style:{cursor:M&&S===o?"grabbing":"grab"},onMouseEnter:()=>P(o),onMouseLeave:()=>P(-1),onMouseDown:e=>{if(f&&f(e,o),M)return;e.preventDefault(),e.stopPropagation(),N(!0);const n=e.clientX,t=e.clientY,i=u[o],r=e=>{e.preventDefault();const r=(e.clientX-n)/b,s=(e.clientY-t)/b,a={x:i.x+r,y:i.y+s};p&&p(o,a)},s=()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s),N(!1),P(-1)};window.addEventListener("mousemove",r),window.addEventListener("mouseup",s)},onContextMenu:e=>d&&d(e,o),className:[He.waypoint,v?He.selected:null].join(" ")},`waypoint-${o}`)}))]})}function je({type:e,src:t,dst:o,scale:i,tmp:r,onContextMenu:s,index:a,n1Box:l,n2Box:c,waypoints:u=[],onWaypointContextMenu:d,onUpdateWaypoint:p,onWaypointMouseDown:f,isWaypointSelected:m}){return t&&o?n.jsx(Ve,{type:e,src:t,dst:o,scale:i,tmp:r,onContextMenu:s,waypoints:u,onWaypointContextMenu:d,onUpdateWaypoint:p,onWaypointMouseDown:f,isWaypointSelected:m}):null}var _e="ContextMenu-module_container__kpcIH",ke="ContextMenu-module_contextMenu__xllaM",Oe="ContextMenu-module_contextMenuItemContainer__T7rR2",Ie="ContextMenu-module_contextMenuItemLabelContainer__fkrNo",Le="ContextMenu-module_contextMenuItemLabel__IJE3x",Ye="ContextMenu-module_contextMenuItemDescription__wVBWj",ze="ContextMenu-module_contextMenuItemSubMenu__n6J-S",Ae="ContextMenu-module_submenu__7UZMP",Re="ContextMenu-module_searchInput__eQZ-H";function Xe(e,n,t={},o=""){if(!e||!n)return o;const i=e[n]?.replace(/\{(\w+)\}/gim,((e,n)=>t[n]||n));return i||o}const We=({isFiltered:t,options:o,onSelectOption:i,style:r})=>{const[s,a]=e.useState(null),[l,c]=e.useState(null),[u,d]=e.useState("left"),[p,f]=e.useState("top"),m=o?.find((e=>e.label===s));return o?.length?n.jsxs("ul",{className:ke,style:r,children:[o?.filter(t)?.sort(((e,n)=>e.label.localeCompare(n.label)))?.map(((e,o)=>!0===e.separator?n.jsx("li",{children:n.jsx("hr",{})},`${e.id}-${o}`):n.jsxs("li",{onClick:n=>i(e,n),onMouseEnter:n=>((e,n)=>{a(n);const t=e.currentTarget.getBoundingClientRect().top-e.currentTarget.parentNode.getBoundingClientRect().top;c(t);const o=window.innerWidth,i=e.target.getBoundingClientRect().width,r=window.innerHeight,s=e.target.getBoundingClientRect().height,l=e.currentTarget.getBoundingClientRect().right;d(l+i>o?"right":"left");const u=e.currentTarget.getBoundingClientRect().bottom;f(u+s>r?"bottom":"top")})(n,e.label),onMouseLeave:()=>{a(null)},children:[n.jsxs("div",{className:Oe,children:[n.jsx("div",{className:Ie,children:n.jsx("div",{className:Le,style:e.style,children:e.label})}),e.children&&n.jsx("div",{className:ze,children:"â–¶"})]}),e.children&&e.label===s&&n.jsx(We,{isFiltered:t,options:e.children.map((n=>({...n,_parent:e}))),onSelectOption:i,className:Ae,style:{[u]:"100%",top:"top"===p?l:null,bottom:"bottom"===p?0:null}})]},`${e.label}-${o}`))),m?.description&&n.jsx("li",{children:n.jsx("div",{className:Ye,children:n.jsx("pre",{children:m.description})})})]}):null},$e=({containerRef:t,i18n:o,children:i})=>{y();const[r,s]=e.useState({x:0,y:0}),[a,l]=e.useState(null),[c,u]=e.useState(""),d=e.useRef(null),p=e.useRef(null),f=e=>{d.current&&!d.current.contains(e.target)&&(u(""),l(null))};e.useEffect((()=>(document.addEventListener("click",f),document.addEventListener("mousedown",f),()=>{document.removeEventListener("click",f),document.removeEventListener("mousedown",f)})),[]);const m=e=>{var n,t;if(!c?.length)return!0;const o=c.toLocaleLowerCase();return(null!==(n=e.label?.toLowerCase()?.indexOf(o))&&void 0!==n?n:-1)>-1||((null!==(t=e.description?.toLowerCase()?.indexOf(o))&&void 0!==t?t:-1)>-1||!(!e.children?.length||!e.children?.some((e=>m(e)))))},v=a?.filter((e=>Boolean(e)));return n.jsxs(n.Fragment,{children:[i({handleContextMenu:(e,n)=>{var o;e.preventDefault(),e.stopPropagation(),setTimeout((()=>p.current?.focus()),0);const i=null!==(o=t.current?.getBoundingClientRect())&&void 0!==o?o:{left:0,top:0},r=e.clientX-i.left,a=e.clientY-i.top;l(n),s({x:r,y:a})}}),v?.length?n.jsxs("div",{ref:d,className:_e,style:{left:r.x,top:r.y,visibility:v?"visible":"hidden"},children:[n.jsx("input",{ref:p,type:"text",className:Re,placeholder:Xe(o,"contextMenu.search",{},"Search"),autoFocus:!0,value:null!=c?c:"",onChange:e=>u(e.target.value)}),n.jsx(We,{isFiltered:m,options:v,onSelectOption:(e,n)=>{n&&n.stopPropagation(),e.onClick?.(e),u(""),l(null)},style:{position:"relative"}})]}):null]})};var Be={container:"Screen-module_container__zkIN3",panel:"Screen-module_panel__P8WaY",controlsPanelVertical:"Screen-module_controlsPanelVertical__-1YKq",controlsPanelHorizontal:"Screen-module_controlsPanelHorizontal__LSyOH",statusPanel:"Screen-module_statusPanel__9lLEm",controlButton:"Screen-module_controlButton__mTn3T"},De={container:"Comment-module_container__ljhnb",selected:"Comment-module_selected__a-fQY",handler:"Comment-module_handler__nJR-3",moveHandler:"Comment-module_moveHandler__-IkO1",title:"Comment-module_title__5dw34",value:"Comment-module_value__A69Js"};const Fe=({title:t,onChangeTitle:o,text:i,onChangeText:r,backgroundColor:s,position:l,size:c,onResize:u,onMove:d,onMoveEnd:p,isSelected:f,nodeId:m,onContextMenu:y})=>{var v,h,x,g;const{scale:b}=a(),C=e.useRef(null),w=e.useCallback((e=>{e.stopPropagation();const n=e.pageX,t=e.pageY,o=e=>{const o=e.pageX-n,i=e.pageY-t;d?.({x:l.x+o/b,y:l.y+i/b})},i=e=>{const r=e.pageX-n,s=e.pageY-t;p?.({x:l.x+r/b,y:l.y+s/b}),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",i)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",i)}),[l,d,p,b]);return e.useEffect((()=>{const e=C.current,n=n=>{c?.w===e.offsetWidth&&c?.h===e.offsetHeight||u?.({w:e.offsetWidth,h:e.offsetHeight})};return e.addEventListener("mouseup",n),()=>{e.removeEventListener("mouseup",n)}}),[]),n.jsxs("div",{ref:C,id:`card-${m}`,className:[De.container,f?De.selected:""].join(" "),style:{backgroundColor:s,transform:`translate(${null!==(v=l?.x)&&void 0!==v?v:0}px, ${null!==(h=l?.y)&&void 0!==h?h:0}px)`,width:null!==(x=c?.w)&&void 0!==x?x:300,height:null!==(g=c?.h)&&void 0!==g?g:200},onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.target.closest("input")||e.target.closest("textarea")||e.stopPropagation()},onContextMenu:y,children:[n.jsx("div",{className:De.moveHandler,onMouseDown:w}),n.jsx("div",{className:De.handler}),n.jsx("input",{className:De.title,placeholder:"Comment",value:null!=t?t:"",onChange:e=>o(e.target.value),onMouseDown:e=>e.stopPropagation()}),n.jsx("textarea",{className:De.value,value:null!=i?i:"",onChange:e=>r(e.target.value),onMouseDown:e=>e.stopPropagation()})]},`card-${m}`)};let Ze=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,n)=>e+=(n&=63)<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n>62?"-":"_"),"");function qe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ke,Je,Ue,Qe,Ge,en,nn,tn,on,rn,sn,an,ln,cn={exports:{}},un={exports:{}},dn={};function pn(){return Je||(Je=1,un.exports=(Ke||(Ke=1,function(){var e="function"==typeof Symbol&&Symbol.for,n=e?Symbol.for("react.element"):60103,t=e?Symbol.for("react.portal"):60106,o=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,r=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,p=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,m=e?Symbol.for("react.lazy"):60116,y=e?Symbol.for("react.block"):60121,v=e?Symbol.for("react.fundamental"):60117,h=e?Symbol.for("react.responder"):60118,x=e?Symbol.for("react.scope"):60119;function g(e){if("object"==typeof e&&null!==e){var p=e.$$typeof;switch(p){case n:var y=e.type;switch(y){case l:case c:case o:case r:case i:case d:return y;default:var v=y&&y.$$typeof;switch(v){case a:case u:case m:case f:case s:return v;default:return p}}case t:return p}}}var b=l,C=c,w=a,S=s,P=n,M=u,N=o,T=m,E=f,H=t,V=r,j=i,_=d,k=!1;function O(e){return g(e)===c}dn.AsyncMode=b,dn.ConcurrentMode=C,dn.ContextConsumer=w,dn.ContextProvider=S,dn.Element=P,dn.ForwardRef=M,dn.Fragment=N,dn.Lazy=T,dn.Memo=E,dn.Portal=H,dn.Profiler=V,dn.StrictMode=j,dn.Suspense=_,dn.isAsyncMode=function(e){return k||(k=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),O(e)||g(e)===l},dn.isConcurrentMode=O,dn.isContextConsumer=function(e){return g(e)===a},dn.isContextProvider=function(e){return g(e)===s},dn.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},dn.isForwardRef=function(e){return g(e)===u},dn.isFragment=function(e){return g(e)===o},dn.isLazy=function(e){return g(e)===m},dn.isMemo=function(e){return g(e)===f},dn.isPortal=function(e){return g(e)===t},dn.isProfiler=function(e){return g(e)===r},dn.isStrictMode=function(e){return g(e)===i},dn.isSuspense=function(e){return g(e)===d},dn.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===c||e===r||e===i||e===d||e===p||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===f||e.$$typeof===s||e.$$typeof===a||e.$$typeof===u||e.$$typeof===v||e.$$typeof===h||e.$$typeof===x||e.$$typeof===y)},dn.typeOf=g}()),dn)),un.exports}
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/function fn(){if(Qe)return Ue;Qe=1;var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;return Ue=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var n={},t=0;t<10;t++)n["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(n).map((function(e){return n[e]})).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(e){o[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(e){return!1}}()?Object.assign:function(o,i){for(var r,s,a=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(o),l=1;l<arguments.length;l++){for(var c in r=Object(arguments[l]))n.call(r,c)&&(a[c]=r[c]);if(e){s=e(r);for(var u=0;u<s.length;u++)t.call(r,s[u])&&(a[s[u]]=r[s[u]])}}return a},Ue}function mn(){if(en)return Ge;en=1;return Ge="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}function yn(){return tn?nn:(tn=1,nn=Function.call.bind(Object.prototype.hasOwnProperty))}function vn(){if(an)return sn;an=1;var e,n=pn(),t=fn(),o=mn(),i=yn(),r=function(){if(rn)return on;rn=1;var e,n=mn(),t={},o=yn();function i(i,r,s,a,l){for(var c in i)if(o(i,c)){var u;try{if("function"!=typeof i[c]){var d=Error((a||"React class")+": "+s+" type `"+c+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof i[c]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw d.name="Invariant Violation",d}u=i[c](r,c,a,s,null,n)}catch(e){u=e}if(!u||u instanceof Error||e((a||"React class")+": type specification of "+s+" `"+c+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof u+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),u instanceof Error&&!(u.message in t)){t[u.message]=!0;var p=l?l():"";e("Failed "+s+" type: "+u.message+(null!=p?p:""))}}}return e=function(e){var n="Warning: "+e;"undefined"!=typeof console&&console.error(n);try{throw new Error(n)}catch(e){}},i.resetWarningCache=function(){t={}},on=i}();function s(){return null}return e=function(e){var n="Warning: "+e;"undefined"!=typeof console&&console.error(n);try{throw new Error(n)}catch(e){}},sn=function(a,l){var c="function"==typeof Symbol&&Symbol.iterator,u="@@iterator";var d="<<anonymous>>",p={array:v("array"),bigint:v("bigint"),bool:v("boolean"),func:v("function"),number:v("number"),object:v("object"),string:v("string"),symbol:v("symbol"),any:y(s),arrayOf:function(e){return y((function(n,t,i,r,s){if("function"!=typeof e)return new m("Property `"+s+"` of component `"+i+"` has invalid PropType notation inside arrayOf.");var a=n[t];if(!Array.isArray(a))return new m("Invalid "+r+" `"+s+"` of type `"+g(a)+"` supplied to `"+i+"`, expected an array.");for(var l=0;l<a.length;l++){var c=e(a,l,i,r,s+"["+l+"]",o);if(c instanceof Error)return c}return null}))},element:y((function(e,n,t,o,i){var r=e[n];return a(r)?null:new m("Invalid "+o+" `"+i+"` of type `"+g(r)+"` supplied to `"+t+"`, expected a single ReactElement.")})),elementType:y((function(e,t,o,i,r){var s=e[t];return n.isValidElementType(s)?null:new m("Invalid "+i+" `"+r+"` of type `"+g(s)+"` supplied to `"+o+"`, expected a single ReactElement type.")})),instanceOf:function(e){return y((function(n,t,o,i,r){if(!(n[t]instanceof e)){var s=e.name||d;return new m("Invalid "+i+" `"+r+"` of type `"+(((a=n[t]).constructor&&a.constructor.name?a.constructor.name:d)+"` supplied to `")+o+"`, expected instance of `"+s+"`.")}var a;return null}))},node:y((function(e,n,t,o,i){return x(e[n])?null:new m("Invalid "+o+" `"+i+"` supplied to `"+t+"`, expected a ReactNode.")})),objectOf:function(e){return y((function(n,t,r,s,a){if("function"!=typeof e)return new m("Property `"+a+"` of component `"+r+"` has invalid PropType notation inside objectOf.");var l=n[t],c=g(l);if("object"!==c)return new m("Invalid "+s+" `"+a+"` of type `"+c+"` supplied to `"+r+"`, expected an object.");for(var u in l)if(i(l,u)){var d=e(l,u,r,s,a+"."+u,o);if(d instanceof Error)return d}return null}))},oneOf:function(n){if(!Array.isArray(n))return e(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),s;return y((function(e,t,o,i,r){for(var s=e[t],a=0;a<n.length;a++)if(f(s,n[a]))return null;var l=JSON.stringify(n,(function(e,n){return"symbol"===b(n)?String(n):n}));return new m("Invalid "+i+" `"+r+"` of value `"+String(s)+"` supplied to `"+o+"`, expected one of "+l+".")}))},oneOfType:function(n){if(!Array.isArray(n))return e("Invalid argument supplied to oneOfType, expected an instance of array."),s;for(var t=0;t<n.length;t++){var r=n[t];if("function"!=typeof r)return e("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+C(r)+" at index "+t+"."),s}return y((function(e,t,r,s,a){for(var l=[],c=0;c<n.length;c++){var u=(0,n[c])(e,t,r,s,a,o);if(null==u)return null;u.data&&i(u.data,"expectedType")&&l.push(u.data.expectedType)}return new m("Invalid "+s+" `"+a+"` supplied to `"+r+"`"+(l.length>0?", expected one of type ["+l.join(", ")+"]":"")+".")}))},shape:function(e){return y((function(n,t,i,r,s){var a=n[t],l=g(a);if("object"!==l)return new m("Invalid "+r+" `"+s+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");for(var c in e){var u=e[c];if("function"!=typeof u)return h(i,r,s,c,b(u));var d=u(a,c,i,r,s+"."+c,o);if(d)return d}return null}))},exact:function(e){return y((function(n,r,s,a,l){var c=n[r],u=g(c);if("object"!==u)return new m("Invalid "+a+" `"+l+"` of type `"+u+"` supplied to `"+s+"`, expected `object`.");var d=t({},n[r],e);for(var p in d){var f=e[p];if(i(e,p)&&"function"!=typeof f)return h(s,a,l,p,b(f));if(!f)return new m("Invalid "+a+" `"+l+"` key `"+p+"` supplied to `"+s+"`.\nBad object: "+JSON.stringify(n[r],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var y=f(c,p,s,a,l+"."+p,o);if(y)return y}return null}))}};function f(e,n){return e===n?0!==e||1/e==1/n:e!=e&&n!=n}function m(e,n){this.message=e,this.data=n&&"object"==typeof n?n:{},this.stack=""}function y(n){var t={},i=0;function r(r,s,a,c,u,p,f){if(c=c||d,p=p||a,f!==o){if(l){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}if("undefined"!=typeof console){var v=c+":"+a;!t[v]&&i<3&&(e("You are manually calling a React.PropTypes validation function for the `"+p+"` prop on `"+c+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),t[v]=!0,i++)}}return null==s[a]?r?null===s[a]?new m("The "+u+" `"+p+"` is marked as required in `"+c+"`, but its value is `null`."):new m("The "+u+" `"+p+"` is marked as required in `"+c+"`, but its value is `undefined`."):null:n(s,a,c,u,p)}var s=r.bind(null,!1);return s.isRequired=r.bind(null,!0),s}function v(e){return y((function(n,t,o,i,r,s){var a=n[t];return g(a)!==e?new m("Invalid "+i+" `"+r+"` of type `"+b(a)+"` supplied to `"+o+"`, expected `"+e+"`.",{expectedType:e}):null}))}function h(e,n,t,o,i){return new m((e||"React class")+": "+n+" type `"+t+"."+o+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+i+"`.")}function x(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(x);if(null===e||a(e))return!0;var n=function(e){var n=e&&(c&&e[c]||e[u]);if("function"==typeof n)return n}(e);if(!n)return!1;var t,o=n.call(e);if(n!==e.entries){for(;!(t=o.next()).done;)if(!x(t.value))return!1}else for(;!(t=o.next()).done;){var i=t.value;if(i&&!x(i[1]))return!1}return!0;default:return!1}}function g(e){var n=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,n){return"symbol"===e||!!n&&("Symbol"===n["@@toStringTag"]||"function"==typeof Symbol&&n instanceof Symbol)}(n,e)?"symbol":n}function b(e){if(null==e)return""+e;var n=g(e);if("object"===n){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return n}function C(e){var n=b(e);switch(n){case"array":case"object":return"an "+n;case"boolean":case"date":case"regexp":return"a "+n;default:return n}}return m.prototype=Error.prototype,p.checkPropTypes=r,p.resetWarningCache=r.resetWarningCache,p.PropTypes=p,p},sn}var hn=function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(o,i,function(n){return e[n]}.bind(null,i));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}([function(e,n){e.exports=function(){if(ln)return cn.exports;ln=1;var e=pn();return cn.exports=vn()(e.isElement,!0),cn.exports}()},function(n,t){n.exports=e},function(e,n,t){t.r(n);var o=t(1),i=t(0),r=function(){return(r=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)},s=0,a=o.forwardRef((function(e,n){var t=e.title,i=void 0===t?null:t,a=e.description,l=void 0===a?null:a,c=e.size,u=void 0===c?null:c,d=e.color,p=void 0===d?"currentColor":d,f=e.horizontal,m=void 0===f?null:f,y=e.vertical,v=void 0===y?null:y,h=e.rotate,x=void 0===h?null:h,g=e.spin,b=void 0===g?null:g,C=e.style,w=void 0===C?{}:C,S=e.children,P=function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)n.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(t[o[i]]=e[o[i]])}return t}(e,["title","description","size","color","horizontal","vertical","rotate","spin","style","children"]);s++;var M,N=null!==b&&b,T=o.Children.map(S,(function(e){var n=e;!0!==N&&(N=!0===(null===b?n.props.spin:b));var t=n.props.size;"number"==typeof u&&"number"==typeof n.props.size&&(t=n.props.size/u);var i={size:t,color:null===p?n.props.color:p,horizontal:null===m?n.props.horizontal:m,vertical:null===v?n.props.vertical:v,rotate:null===x?n.props.rotate:x,spin:null===b?n.props.spin:b,inStack:!0};return o.cloneElement(n,i)}));null!==u&&(w.width="string"==typeof u?u:1.5*u+"rem");var E,H="stack_labelledby_"+s,V="stack_describedby_"+s;if(i)M=l?H+" "+V:H;else if(E="presentation",l)throw new Error("title attribute required when description is set");return o.createElement("svg",r({ref:n,viewBox:"0 0 24 24",style:w,role:E,"aria-labelledby":M},P),i&&o.createElement("title",{id:H},i),l&&o.createElement("desc",{id:V},l),N&&o.createElement("style",null,"@keyframes spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }","@keyframes spin-inverse { from { transform: rotate(0deg) } to { transform: rotate(-360deg) } }"),T)}));a.displayName="Stack",a.propTypes={size:i.oneOfType([i.number,i.string]),color:i.string,horizontal:i.bool,vertical:i.bool,rotate:i.number,spin:i.oneOfType([i.bool,i.number]),children:i.oneOfType([i.arrayOf(i.node),i.node]).isRequired,className:i.string,style:i.object},a.defaultProps={size:null,color:null,horizontal:null,vertical:null,rotate:null,spin:null};var l=a;t.d(n,"Icon",(function(){return d})),t.d(n,"Stack",(function(){return l}));var c=function(){return(c=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)},u=0,d=o.forwardRef((function(e,n){var t=e.path,i=e.id,r=void 0===i?++u:i,s=e.title,a=void 0===s?null:s,l=e.description,d=void 0===l?null:l,p=e.size,f=void 0===p?null:p,m=e.color,y=void 0===m?"currentColor":m,v=e.horizontal,h=void 0!==v&&v,x=e.vertical,g=void 0!==x&&x,b=e.rotate,C=void 0===b?0:b,w=e.spin,S=void 0!==w&&w,P=e.style,M=void 0===P?{}:P,N=e.inStack,T=void 0!==N&&N,E=function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)n.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(t[o[i]]=e[o[i]])}return t}(e,["path","id","title","description","size","color","horizontal","vertical","rotate","spin","style","inStack"]),H={},V=[];null!==f&&(T?V.push("scale("+f+")"):(M.width="string"==typeof f?f:1.5*f+"rem",M.height=M.width)),h&&V.push("scaleX(-1)"),g&&V.push("scaleY(-1)"),0!==C&&V.push("rotate("+C+"deg)"),null!==y&&(H.fill=y);var j=o.createElement("path",c({d:t,style:H},T?E:{})),_=j;V.length>0&&(M.transform=V.join(" "),M.transformOrigin="center",T&&(_=o.createElement("g",{style:M},j,o.createElement("rect",{width:"24",height:"24",fill:"transparent"}))));var k,O=_,I=!0===S||"number"!=typeof S?2:S,L=!T&&(h||g);if(I<0&&(L=!L),S&&(O=o.createElement("g",{style:{animation:"spin"+(L?"-inverse":"")+" linear "+Math.abs(I)+"s infinite",transformOrigin:"center"}},_,!(h||g||0!==C)&&o.createElement("rect",{width:"24",height:"24",fill:"transparent"}))),T)return O;var Y,z="icon_labelledby_"+r,A="icon_describedby_"+r;if(a)k=d?z+" "+A:z;else if(Y="presentation",d)throw new Error("title attribute required when description is set");return o.createElement("svg",c({ref:n,viewBox:"0 0 24 24",style:M,role:Y,"aria-labelledby":k},E),a&&o.createElement("title",{id:z},a),d&&o.createElement("desc",{id:A},d),!T&&S&&(L?o.createElement("style",null,"@keyframes spin-inverse { from { transform: rotate(0deg) } to { transform: rotate(-360deg) } }"):o.createElement("style",null,"@keyframes spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }")),O)}));d.displayName="Icon",d.propTypes={path:i.string.isRequired,size:i.oneOfType([i.number,i.string]),color:i.string,horizontal:i.bool,vertical:i.bool,rotate:i.number,spin:i.oneOfType([i.bool,i.number]),style:i.object,inStack:i.bool,className:i.string},d.defaultProps={size:null,color:"currentColor",horizontal:!1,vertical:!1,rotate:0,spin:!1},n.default=d}]),xn=qe(hn);const gn=({children:e,...t})=>{const{currentTheme:o}=y();return n.jsx("button",{...t,style:{backgroundColor:o.buttons?.default?.backgroundColor,border:o.buttons?.default?.border,color:o.buttons?.default?.color,borderRadius:o.roundness},children:e})},bn=({zoomIn:e,zoomOut:t,centerView:o,resetView:i,canMove:r,setCanMove:s,position:a,scale:l,setStateAndNotify:c})=>n.jsxs("div",{className:[Be.panel,Be.controlsPanelVertical].join(" "),children:[n.jsx(gn,{className:Be.controlButton,onClick:()=>e(),children:n.jsx(xn,{path:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M8,5V8H5V10H8V13H10V10H13V8H10V5H8Z",size:.6})}),n.jsx(gn,{className:Be.controlButton,onClick:()=>t(),children:n.jsx(xn,{path:"M9,2A7,7 0 0,1 16,9C16,10.57 15.5,12 14.61,13.19L15.41,14H16L22,20L20,22L14,16V15.41L13.19,14.61C12,15.5 10.57,16 9,16A7,7 0 0,1 2,9A7,7 0 0,1 9,2M5,8V10H13V8H5Z",size:.6})}),n.jsx(gn,{className:Be.controlButton,onClick:()=>{o(),c((e=>({...e,position:a,scale:l})))},children:n.jsx(xn,{path:"M9,5A7,7 0 0,0 2,12A7,7 0 0,0 9,19C10.04,19 11.06,18.76 12,18.32C12.94,18.76 13.96,19 15,19A7,7 0 0,0 22,12A7,7 0 0,0 15,5C13.96,5 12.94,5.24 12,5.68C11.06,5.24 10.04,5 9,5M9,7C9.34,7 9.67,7.03 10,7.1C8.72,8.41 8,10.17 8,12C8,13.83 8.72,15.59 10,16.89C9.67,16.96 9.34,17 9,17A5,5 0 0,1 4,12A5,5 0 0,1 9,7M15,7A5,5 0 0,1 20,12A5,5 0 0,1 15,17C14.66,17 14.33,16.97 14,16.9C15.28,15.59 16,13.83 16,12C16,10.17 15.28,8.41 14,7.11C14.33,7.04 14.66,7 15,7Z",size:.6})}),n.jsx(gn,{className:Be.controlButton,onClick:()=>{i(),c((e=>({...e,position:a,scale:1})))},children:n.jsx(xn,{path:"M17 22V20H20V17H22V20.5C22 20.89 21.84 21.24 21.54 21.54C21.24 21.84 20.89 22 20.5 22H17M7 22H3.5C3.11 22 2.76 21.84 2.46 21.54C2.16 21.24 2 20.89 2 20.5V17H4V20H7V22M17 2H20.5C20.89 2 21.24 2.16 21.54 2.46C21.84 2.76 22 3.11 22 3.5V7H20V4H17V2M7 2V4H4V7H2V3.5C2 3.11 2.16 2.76 2.46 2.46C2.76 2.16 3.11 2 3.5 2H7M10.5 6C13 6 15 8 15 10.5C15 11.38 14.75 12.2 14.31 12.9L17.57 16.16L16.16 17.57L12.9 14.31C12.2 14.75 11.38 15 10.5 15C8 15 6 13 6 10.5C6 8 8 6 10.5 6M10.5 8C9.12 8 8 9.12 8 10.5C8 11.88 9.12 13 10.5 13C11.88 13 13 11.88 13 10.5C13 9.12 11.88 8 10.5 8Z",size:.6})}),n.jsx(gn,{className:Be.controlButton,onClick:()=>s(!r),children:n.jsx(xn,{path:r?"M18 1C15.24 1 13 3.24 13 6V8H4C2.9 8 2 8.89 2 10V20C2 21.11 2.9 22 4 22H16C17.11 22 18 21.11 18 20V10C18 8.9 17.11 8 16 8H15V6C15 4.34 16.34 3 18 3C19.66 3 21 4.34 21 6V8H23V6C23 3.24 20.76 1 18 1M10 13C11.1 13 12 13.89 12 15C12 16.11 11.11 17 10 17C8.9 17 8 16.11 8 15C8 13.9 8.9 13 10 13Z":"M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z",size:.6})})]}),Cn=({snapToGrid:e,handleSnapToGrid:t,viewMode:o})=>n.jsxs("div",{className:[Be.panel,Be.controlsPanelHorizontal].join(" "),children:[n.jsx(gn,{className:Be.controlButton,onClick:t,children:n.jsx(xn,{path:e?"M10,4V8H14V4H10M16,4V8H20V4H16M16,10V14H20V10H16M16,16V20H20V16H16M14,20V16H10V20H14M8,20V16H4V20H8M8,14V10H4V14H8M8,8V4H4V8H8M10,14H14V10H10V14M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4C2.92,22 2,21.1 2,20V4A2,2 0 0,1 4,2Z":"M0,2.77L1.28,1.5L22.5,22.72L21.23,24L19.23,22H4C2.92,22 2,21.1 2,20V4.77L0,2.77M10,4V7.68L8,5.68V4H6.32L4.32,2H20A2,2 0 0,1 22,4V19.7L20,17.7V16H18.32L16.32,14H20V10H16V13.68L14,11.68V10H12.32L10.32,8H14V4H10M16,4V8H20V4H16M16,20H17.23L16,18.77V20M4,8H5.23L4,6.77V8M10,14H11.23L10,12.77V14M14,20V16.77L13.23,16H10V20H14M8,20V16H4V20H8M8,14V10.77L7.23,10H4V14H8Z",size:.6})}),n.jsxs(gn,{disabled:!0,className:Be.controlButton,children:["select"===o&&n.jsx(xn,{path:"M4,3H5V5H3V4A1,1 0 0,1 4,3M20,3A1,1 0 0,1 21,4V5H19V3H20M15,5V3H17V5H15M11,5V3H13V5H11M7,5V3H9V5H7M21,20A1,1 0 0,1 20,21H19V19H21V20M15,21V19H17V21H15M11,21V19H13V21H11M7,21V19H9V21H7M4,21A1,1 0 0,1 3,20V19H5V21H4M3,15H5V17H3V15M21,15V17H19V15H21M3,11H5V13H3V11M21,11V13H19V11H21M3,7H5V9H3V7M21,7V9H19V7H21Z",size:.6}),"select-add"===o&&n.jsx(xn,{path:"M13,17H17V13H19V17H23V19H19V23H17V19H13V17M11,17V19H9V17H11M7,17V19H5V17H7M19,9V11H17V9H19M19,5V7H17V5H19M15,5V7H13V5H15M11,5V7H9V5H11M7,5V7H5V5H7M7,13V15H5V13H7M7,9V11H5V9H7Z",size:.6}),"select-remove"===o&&n.jsx(xn,{path:"M21 20C21 20.55 20.55 21 20 21H19V19H21V20M15 21V19H17V21H15M11 21V19H13V21H11M7 21V19H9V21H7M4 21C3.45 21 3 20.55 3 20V19H5V21H4M3 15H5V17H3V15M21 15V17H19V15H21M14.59 8L12 10.59L9.41 8L8 9.41L10.59 12L8 14.59L9.41 16L12 13.41L14.59 16L16 14.59L13.41 12L16 9.41L14.59 8M3 11H5V13H3V11M21 11V13H19V11H21M3 7H5V9H3V7M21 7V9H19V7H21M4 3H5V5H3V4C3 3.45 3.45 3 4 3M20 3C20.55 3 21 3.45 21 4V5H19V3H20M15 5V3H17V5H15M11 5V3H13V5H11M7 5V3H9V5H7Z",size:.6}),"move"===o&&n.jsx(xn,{path:"M13,6V11H18V7.75L22.25,12L18,16.25V13H13V18H16.25L12,22.25L7.75,18H11V13H6V16.25L1.75,12L6,7.75V11H11V6H7.75L12,1.75L16.25,6H13Z",size:.6})]})]}),wn=({scale:e,position:t})=>n.jsxs("div",{className:[Be.panel,Be.statusPanel].join(" "),children:[n.jsxs("div",{children:["Scale: ",e]}),n.jsxs("div",{children:["Position: ",JSON.stringify(t)]})]});var Sn="SelectionArea-module_container__td0Oq";const Pn=({localStartPoint:e,localEndPoint:t})=>(y(),e.x===t.x||e.y===t.y?null:n.jsx("div",{className:Sn,style:{transform:`translate(${Math.min(e.x,t.x)}px, ${Math.min(e.y,t.y)}px)`,width:Math.abs(t.x-e.x),height:Math.abs(t.y-e.y)}}));const Mn={"contextMenu.search":"Search","contextMenu.add":"Add {nodeType}","contextMenu.removeThisNode":"Remove this node","contextMenu.removeSelectedNodes":"Remove selected nodes","contextMenu.cloneThisNode":"Clone this node","contextMenu.removeThisConnection":"Remove this connection","contextMenu.addWaypoint":"Add waypoint","contextMenu.removeWaypoint":"Remove waypoint"};function Nn({portTypes:t,nodeTypes:o,onChangeState:r,initialState:s,i18n:c=Mn,debugMode:u}){var d,p,f,m,v;const h={label:Xe(c,"contextMenu.comment.label",{},"Comment"),type:"comment",inputs:()=>[],outputs:()=>[]};o&&(o.comment=h);const{currentTheme:x}=y(),b={"--port-size":"20px","--color-primary":x.colors?.primary,"--color-secondary":x.colors?.secondary,"--color-bg":x.colors?.background,"--color-text":x.colors?.text,"--color-hover":x.colors?.hover,"--color-selection-border":x.colors?.selectionBorder,"--roundness":x.roundness},{dragInfo:w}=i(),{position:S,setPosition:P,scale:M,setScale:N}=a(),[T,E]=e.useState({x:0,y:0}),[H,V]=e.useState({x:0,y:0}),[j,_]=e.useState(!1),[k,O]=e.useState(!1),[I,L]=e.useState(s),[Y,z]=e.useState(!1),[A,R]=e.useState("select"),{selectedNodes:X,setSelectedNodes:W,selectedWaypoints:$,setSelectedWaypoints:B,selectStartPoint:D,setSelectStartPoint:F,selectEndPoint:Z,setSelectEndPoint:q,clearSelection:K,selectAllNodes:J,addNodesToSelection:U,removeNodesFromSelection:Q,addWaypointToSelection:G,removeWaypointFromSelection:ee,isWaypointSelected:ne,processAreaSelection:te}=function({state:n}){const[t,o]=e.useState([]),[i,r]=e.useState([]),[s,a]=e.useState({x:0,y:0}),[l,c]=e.useState({x:0,y:0}),u=e.useCallback((()=>{o([]),r([])}),[]),d=e.useCallback((()=>{n?.nodes&&o(Object.keys(n.nodes))}),[n?.nodes]),p=e.useCallback((e=>{o((n=>{const t=e.filter((e=>!n.includes(e)));return[...n,...t]}))}),[]),f=e.useCallback((e=>{o((n=>n.filter((n=>!e.includes(n)))))}),[]),m=e.useCallback((e=>{r((n=>n.some((n=>n.srcNode===e.srcNode&&n.srcPort===e.srcPort&&n.dstNode===e.dstNode&&n.dstPort===e.dstPort&&n.waypointIndex===e.waypointIndex))?n:[...n,e]))}),[]),y=e.useCallback((e=>{r((n=>n.filter((n=>!(n.srcNode===e.srcNode&&n.srcPort===e.srcPort&&n.dstNode===e.dstNode&&n.dstPort===e.dstPort&&n.waypointIndex===e.waypointIndex)))))}),[]),v=e.useCallback((e=>!!(e&&"object"==typeof e&&e.srcNode&&e.dstNode&&e.srcPort&&e.dstPort&&void 0!==e.waypointIndex)&&i.some((n=>n.srcNode===e.srcNode&&n.srcPort===e.srcPort&&n.dstNode===e.dstNode&&n.dstPort===e.dstPort&&n.waypointIndex===e.waypointIndex))),[i]),h=e.useCallback((e=>{o((n=>{const t=e.filter((e=>!n.includes(e)));return[...n,...t]}))}),[]),x=e.useCallback((e=>{o((n=>n.filter((n=>!e.includes(n)))))}),[]),g=e.useCallback(((e,n,t,i=[])=>{e&&(t?.length>0||i?.length>0?"select"===n?(o(t||[]),r(i||[])):"select-add"===n?(t?.length>0&&p(t),i?.length>0&&i.forEach((e=>m(e)))):"select-remove"===n&&(t?.length>0&&f(t),i?.length>0&&i.forEach((e=>y(e)))):"select"===n&&u())}),[p,f,m,y,h,x,u]);return{selectedNodes:t,setSelectedNodes:o,selectedWaypoints:i,setSelectedWaypoints:r,selectStartPoint:s,setSelectStartPoint:a,selectEndPoint:l,setSelectEndPoint:c,clearSelection:u,selectAllNodes:d,addNodesToSelection:p,removeNodesFromSelection:f,addWaypointToSelection:m,removeWaypointFromSelection:y,addCommentsToSelection:h,removeCommentsFromSelection:x,isWaypointSelected:v,processAreaSelection:g}}({state:I});e.useState({x:0,y:0});const oe=e.useCallback(((e,n=200,t)=>(...o)=>clearTimeout(t,t=setTimeout((()=>e(...o)),n))),[]);e.useEffect((()=>{s&&(s.scale&&N(s.scale),s.position&&P(s.position))}),[s,N,P]);const ie=e.useCallback((e=>{L((n=>{const t=e(n);return z(!0),t}))}),[L]),re=e.useRef(),se=re.current?.getBoundingClientRect(),ae=e.useRef(),{addNode:le,removeNodes:ce,cloneNode:ue,removeConnectionFromOutput:de,addWaypoint:pe,updateWaypointPosition:fe,removeWaypoint:me,connectNodes:ye,updateNodeValues:ve}=function({state:n,setStateAndNotify:t,setSelectedNodes:o,nodeTypes:i}){return{addNode:e.useCallback(((e,n)=>{const o={id:Ze(),name:e.label,type:e.type,position:n,values:e.inputs().reduce(((e,n)=>(null==n.defaultValue||(e[n.name]=n.defaultValue),e)),{})};t((e=>{var n;return{...e,nodes:{...null!==(n=e.nodes)&&void 0!==n?n:{},[o.id]:o}}}))}),[t]),removeNodes:e.useCallback((e=>{if(!e?.length)return;const r=e.filter((e=>!i[n.nodes[e]?.type]?.root)),s=[...e],a={};for(const t of e){const e=n.nodes[t];if(e){if(e.connections?.outputs?.length)for(const t of e.connections.outputs){var l,c;const o=n.nodes[t.node];var u,d;if(o&&!r.includes(o.id))s.includes(o.id)||s.push(o.id),a[o.id]||(a[o.id]={...o,connections:{...o.connections,inputs:null!==(u=o.connections?.inputs)&&void 0!==u?u:[],outputs:null!==(d=o.connections?.outputs)&&void 0!==d?d:[]}}),a[o.id].connections.outputs=[...null!==(l=o.connections.outputs)&&void 0!==l?l:[]],a[o.id].connections.inputs=null!==(c=o.connections?.inputs?.filter((n=>!(n.port===t.name&&n.node===e.id))))&&void 0!==c?c:[]}if(e.connections?.inputs?.length)for(const t of e.connections.inputs){var p,f;const o=n.nodes[t.node];o&&!r.includes(o.id)&&(s.includes(o.id)||s.push(o.id),a[o.id]||(a[o.id]={...o}),a[o.id].connections.outputs=null!==(p=o.connections?.outputs?.filter((n=>!(n.port===t.name&&n.node===e.id))))&&void 0!==p?p:[],a[o.id].connections.inputs=[...null!==(f=o.connections.inputs)&&void 0!==f?f:[]])}}}o([]),t((e=>{var t;const o={...null!==(t=e.nodes)&&void 0!==t?t:{}};return s.filter((e=>!i[n.nodes[e]?.type]?.root)).forEach((e=>{delete o[e]})),Object.values(a).forEach((e=>{o[e.id]=e})),{...e,nodes:o}}))}),[n,t,o,i]),cloneNode:e.useCallback((e=>{const o=n.nodes[e];if(!o)return;const i={...o,id:Ze(),position:{x:o.position.x+20,y:o.position.y+20},connections:{inputs:[],outputs:[]}};t((e=>{var n;return{...e,nodes:{...null!==(n=e.nodes)&&void 0!==n?n:{},[i.id]:i}}}))}),[t,n]),removeConnectionFromOutput:e.useCallback(((e,n,o,i)=>{t((t=>{var r;const s={...null!==(r=t.nodes)&&void 0!==r?r:{}};return s[e]&&s[o]?(s[e]={...s[e],connections:{...s[e].connections,outputs:s[e].connections.outputs.filter((e=>!(e.name===n&&e.node===o&&e.port===i)))}},s[o]={...s[o],connections:{...s[o].connections,inputs:s[o].connections.inputs.filter((t=>!(t.name===i&&t.node===e&&t.port===n)))}},{...t,nodes:s}):t}))}),[t]),addWaypoint:e.useCallback(((e,n,o,i,r)=>{t((t=>{var s;const a={...null!==(s=t.nodes)&&void 0!==s?s:{}};if(!a[e])return t;const l=a[e].connections?.outputs?.findIndex((e=>e.name===n&&e.node===o&&e.port===i));if(-1===l)return t;const c={...a[e].connections.outputs[l],waypoints:[...a[e].connections.outputs[l].waypoints||[]]};return c.waypoints.push(r),a[e]={...a[e],connections:{...a[e].connections,outputs:[...a[e].connections.outputs.slice(0,l),c,...a[e].connections.outputs.slice(l+1)]}},{...t,nodes:a}}))}),[t]),updateWaypointPosition:e.useCallback(((e,n,o,i,r,s)=>{t((t=>{var a;const l={...null!==(a=t.nodes)&&void 0!==a?a:{}};if(!l[e])return t;const c=l[e].connections?.outputs?.findIndex((e=>e.name===n&&e.node===o&&e.port===i));if(-1===c)return t;const u={...l[e].connections.outputs[c],waypoints:[...l[e].connections.outputs[c].waypoints||[]]};return r>=0&&r<u.waypoints.length&&(u.waypoints[r]=s),l[e]={...l[e],connections:{...l[e].connections,outputs:[...l[e].connections.outputs.slice(0,c),u,...l[e].connections.outputs.slice(c+1)]}},{...t,nodes:l}}))}),[t]),removeWaypoint:e.useCallback(((e,n,o,i,r)=>{t((t=>{var s;const a={...null!==(s=t.nodes)&&void 0!==s?s:{}};if(!a[e])return t;const l=a[e].connections?.outputs?.findIndex((e=>e.name===n&&e.node===o&&e.port===i));if(-1===l)return t;const c={...a[e].connections.outputs[l],waypoints:[...a[e].connections.outputs[l].waypoints||[]]};return c.waypoints.splice(r,1),a[e]={...a[e],connections:{...a[e].connections,outputs:[...a[e].connections.outputs.slice(0,l),c,...a[e].connections.outputs.slice(l+1)]}},{...t,nodes:a}}))}),[t]),connectNodes:e.useCallback((({source:e,target:n})=>{let o=!1;return t((t=>{if(!t?.nodes||!Object.keys(t.nodes).length)return null;const r=e.nodeId,s=n.nodeId,a=e.portName,l=n.portName;if(r===s)return t;const c=JSON.parse(JSON.stringify(t.nodes[r])),u=JSON.parse(JSON.stringify(t.nodes[s])),d=i[c.type].outputs(c.values,c.connections?.inputs).find((e=>e.name===a)),p=i[u.type].inputs(u.values).find((e=>e.name===l));if(!d||!p||d.type!==p.type)return t;c.connections||(c.connections={}),c.connections?.outputs||(c.connections.outputs=[]),c.connections?.inputs||(c.connections.inputs=[]),u.connections||(u.connections={}),u.connections?.outputs||(u.connections.outputs=[]),u.connections?.inputs||(u.connections.inputs=[]),c.connections.outputs.find((e=>e.node===u.id&&e.name===p.name))||c.connections.outputs.push({name:d.name,node:u.id,port:p.name,type:d.type,waypoints:[]}),u.connections.inputs.find((e=>e.node===c.id&&e.name===d.name))||u.connections.inputs.push({name:p.name,node:c.id,port:d.name,type:d.type});const f={...t.nodes,[c.id]:c,[u.id]:u};return o=!0,{...t,nodes:f}})),o}),[t,i]),updateNodeValues:e.useCallback(((e,n)=>{t((t=>({...t,nodes:{...t.nodes,[e]:{...t.nodes[e],values:n}}})))}),[t])}}({state:I,setStateAndNotify:ie,setSelectedNodes:W,nodeTypes:o}),{copyNodesToClipboard:he,pasteNodesFromClipboard:xe}=function({state:n,setStateAndNotify:t,setSelectedNodes:o,setSelectedWaypoints:i,nodeTypes:r,position:s,scale:a,pointerPosition:l,screenRef:c}){return{copyNodesToClipboard:e.useCallback((e=>{if(!e?.length)return void console.warn("[useClipboard] No nodes selected to copy");const t={};for(const o of e)n.nodes[o]?t[o]=n.nodes[o]:console.warn(`[useClipboard] Node with id ${o} not found in state`);if(0===Object.keys(t).length)return void console.warn("[useClipboard] Could not find any nodes to copy");const o=JSON.stringify(t);navigator.clipboard.writeText(o).catch((e=>console.error("[useClipboard] Error copying data:",e)))}),[n?.nodes]),pasteNodesFromClipboard:e.useCallback(((e=null)=>{if(!c?.current)return void console.error("[useClipboard] screenRef not available");const n=e||window.mousePosition||l;navigator.clipboard.readText().then((e=>{try{if(!e)return void console.warn("[useClipboard] Empty clipboard");const l=JSON.parse(e),u=Object.values(l).filter((e=>!e.root));if(0===u.length)return void console.warn("[useClipboard] No valid nodes to paste");let d=!0,p="";for(const e of u){if(!r[e.type]){d=!1,p=`Invalid node type: ${e.type}`;break}if(!e.position){d=!1,p=`Node without position: ${e.id}`;break}e.connections?void 0!==e.connections.inputs&&void 0!==e.connections.outputs||(void 0===e.connections.inputs&&(e.connections.inputs=[]),void 0===e.connections.outputs&&(e.connections.outputs=[])):e.connections={inputs:[],outputs:[]}}if(!d)return void console.error(`[useClipboard] Invalid data: ${p}`);const f=u.reduce(((e,n)=>{var t;return n.position.x<(null!==(t=e?.position?.x)&&void 0!==t?t:Number.POSITIVE_INFINITY)?n:e}),null);if(!f)return void console.error("[useClipboard] Could not find reference node for positioning");const m={x:f.position.x,y:f.position.y};if(!c.current)return void console.error("[useClipboard] screenRef.current not available");const y=c.current.getBoundingClientRect();if(!y)return void console.error("[useClipboard] Could not get element rectangle");const{x:v,y:h}=y,x={x:(n.x-v-s.x)/a,y:(n.y-h-s.y)/a},g={},b=u.map((e=>{const n=e.id,t=Ze();g[n]=t;const o={x:e.position.x-m.x+x.x,y:e.position.y-m.y+x.y};return{...e,id:t,position:o,connections:{inputs:e.connections?.inputs?.filter((e=>u.find((n=>n.id===e.node)))),outputs:e.connections?.outputs?.filter((e=>u.find((n=>n.id===e.node))))}}}));for(const e of b){if(e.connections?.inputs)for(const n of e.connections.inputs)n.node=g[n.node];if(e.connections?.outputs)for(const n of e.connections.outputs)n.node=g[n.node],n.waypoints&&n.waypoints.length>0&&(n.waypoints=n.waypoints.map((e=>({x:e.x-m.x+x.x,y:e.y-m.y+x.y}))))}const C=[];for(const e of b)if(e.connections?.outputs)for(const n of e.connections.outputs)n.waypoints&&n.waypoints.length>0&&n.waypoints.forEach(((t,o)=>{C.push({srcNode:e.id,srcPort:n.name,dstNode:n.node,dstPort:n.port,waypointIndex:o})}));t((e=>{const n={...e.nodes,...b.reduce(((e,n)=>(e[n.id]=n,e)),{})};return{...e,nodes:n}}));const w=b.map((e=>e.id));o&&o(w),i&&i(C)}catch(e){console.error("[useClipboard] Error processing clipboard data:",e)}})).catch((e=>{console.error("[useClipboard] Error reading from clipboard:",e)}))}),[n,t,o,i,r,s,a,c])}}({state:I,setStateAndNotify:ie,setSelectedNodes:W,setSelectedWaypoints:B,nodeTypes:o,position:S,scale:M,pointerPosition:H,screenRef:re});!function({screenRef:n,removeNodes:t,selectedNodes:o,setSelectedNodes:i,selectAllNodes:r,copyNodesToClipboard:s,pasteNodesFromClipboard:a}){e.useEffect((()=>{const e=n.current;if(!e)return;const l=()=>{},c=e=>{if(n.current===document.activeElement){switch(e.key.toLowerCase()){case"delete":case"backspace":t(o);break;case"escape":i([])}if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"a":e.preventDefault(),e.stopPropagation(),r();break;case"c":e.preventDefault(),e.stopPropagation(),s(o);break;case"v":e.preventDefault(),e.stopPropagation();const n=window.mousePosition||{x:e.clientX,y:e.clientY};a(n)}}};return e.addEventListener("focus",l),e.addEventListener("blur",l),e.addEventListener("keydown",c),()=>{e.removeEventListener("focus",l),e.removeEventListener("blur",l),e.removeEventListener("keydown",c)}}),[n.current,o,t,i,r,s,a])}({screenRef:re,removeNodes:ce,selectedNodes:X,setSelectedNodes:W,selectAllNodes:J,copyNodesToClipboard:he,pasteNodesFromClipboard:xe});const ge=e.useCallback((e=>{if(1===e.button)return void R("move");if(0!==e.button)return;e.stopPropagation();const n=e.ctrlKey?"select-remove":e.shiftKey?"select-add":"select";R(n);const t=e.pageX+window.scrollX,o=e.pageY+window.scrollY,i={x:t,y:o};F(i),q(i);const r=e=>{const n=e.pageX+window.scrollX,t=e.pageY+window.scrollY;q({x:n,y:t})},s=e=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s);const a=e.pageX+window.scrollX,l=e.pageY+window.scrollY;if(Math.abs(a-t)>=2&&Math.abs(l-o)>=2){const e={x:a,y:l};q(e);const t=[],o=I.nodes?Object.values(I.nodes):[],r={x:Math.min(i.x,e.x),y:Math.min(i.y,e.y)},s={x:Math.max(i.x,e.x),y:Math.max(i.y,e.y)};o.forEach((e=>{const n=document.getElementById(`card-${e.id}`);if(!n)return;const{x:o,y:i,width:a,height:l}=n.getBoundingClientRect();o>r.x&&o+a<s.x&&i>r.y&&i+l<s.y&&t.push(e.id)}));const c=[];I.nodes&&Object.values(I.nodes).forEach((e=>{e.connections?.outputs&&e.connections.outputs.forEach((n=>{n.waypoints&&n.waypoints.forEach(((t,o)=>{const i=t.x*M+S.x+window.scrollX,a=t.y*M+S.y+window.scrollY;i>r.x&&i<s.x&&a>r.y&&a<s.y&&c.push({srcNode:e.id,srcPort:n.name,dstNode:n.node,dstPort:n.port,waypointIndex:o})}))}))})),console.warn("selectedWaypoints",c),te({p1:r,p2:s},n,t,c),F(e)}F({x:0,y:0}),q({x:0,y:0})};window.addEventListener("mousemove",r),window.addEventListener("mouseup",s)}),[S,M,I,X]);e.useEffect((()=>{const e=e=>{const n={x:e.pageX-window.scrollX,y:e.pageY-window.scrollY};window.mousePosition=n,V(n)};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[]),e.useEffect((()=>{if(!w){if(T&&!k){_(!0);const e=setTimeout((()=>{E(null),_(!1)}),500);return()=>clearTimeout(e)}return E(null),void O(!1)}_(!1),O(!1);const e=e=>{const n=e.pageX,t=e.pageY;E({x:n,y:t,srcX:w.startX,srcY:w.startY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[w,T,k]);const[be,Ce]=e.useState(!1),[we,Se]=e.useState(!0),[Pe,Ne]=e.useState(!0),Te=e.useCallback((e=>{const n=e.state.scale;N(n);const t={x:e.state.positionX,y:e.state.positionY};P(t)}),[P,N]);e.useCallback((e=>{ie((n=>({...n,scale:e.state.scale,position:{x:e.state.positionX,y:e.state.positionY}})))}),[ie]);const He=e.useCallback((e=>{const n={x:e.state.positionX,y:e.state.positionY};P(n)}),[P]),_e=e.useCallback((e=>{const{state:{positionX:n,positionY:t,scale:o}}=e;P({x:n,y:t}),N(o),oe(((e,n,t)=>{ie((o=>({...o,position:{x:e,y:n},scale:t})))}),200)(n,t,o)}),[P,N,ie,oe]),ke=40,Oe=ke*(null!=M?M:1),Ie=(null!==(d=S?.x)&&void 0!==d?d:0)%Oe,Le=(null!==(p=S?.y)&&void 0!==p?p:0)%Oe,{moveHandler:Ye}=function({state:n,setState:t,setStateAndNotify:o,gridSize:i,snapToGrid:r,selectedNodes:s,setSelectedNodes:a,selectedWaypoints:l,setSelectedWaypoints:c,isWaypointSelected:u}){return e.useEffect((()=>{console.log("[useElementMovement] Initialized with state:",n)}),[n]),{moveHandler:e.useCallback(((e,n,l)=>{const c={...n},d=[...s];d.includes(e.id)||(d.length=0,d.push(e.id)),a(d),(l?t:o)((n=>({...n,nodes:Object.values(n.nodes).reduce(((t,o)=>{const s={x:c.x-n.nodes[e.id].position.x,y:c.y-n.nodes[e.id].position.y};return r&&(c.x=Math.round(c.x/i)*i,c.y=Math.round(c.y/i)*i,s.x=c.x-n.nodes[e.id].position.x,s.y=c.y-n.nodes[e.id].position.y),o.id===e.id?t[o.id]={...o,position:c,connections:{...o.connections,outputs:o.connections?.outputs?.map((e=>({...e,waypoints:e.waypoints?.map(((n,t)=>u({srcNode:o.id,srcPort:e.name,dstNode:e.node,dstPort:e.port,waypointIndex:t})?{x:n.x+s.x,y:n.y+s.y}:n))})))}}:d.includes(o.id)?t[o.id]={...o,position:{x:o.position.x+s.x,y:o.position.y+s.y},connections:{...o.connections,outputs:o.connections?.outputs?.map((e=>({...e,waypoints:e.waypoints?.map(((n,t)=>u({srcNode:o.id,srcPort:e.name,dstNode:e.node,dstPort:e.port,waypointIndex:t})?{x:n.x+s.x,y:n.y+s.y}:n))})))}}:t[o.id]=o,t}),{})})))}),[s,l,a,t,o,r,i,u])}}({state:I,setState:L,setStateAndNotify:ie,selectedWaypoints:$,gridSize:ke,snapToGrid:Pe,selectedNodes:X,setSelectedNodes:W,selectedWaypoints:$,setSelectedWaypoints:B,isWaypointSelected:ne}),ze=e.useCallback((e=>{const n=ye(e);return O(Boolean(n)),console.log("Connection attempt:",n?"successful":"failed"),n}),[ye]),Ae=e.useMemo((()=>({step:5})),[]),Re=e.useMemo((()=>({disabled:be,excluded:[g.node,"react-draggable",l.port,l.portConnector,De.container,De.moveHandler]})),[be]),We=e.useMemo((()=>({height:"100%",width:"100%",backgroundColor:x.colors?.background,backgroundSize:`${Oe}px ${Oe}px`,backgroundImage:`linear-gradient(to right, ${x.colors?.hover} 1px, transparent 1px), linear-gradient(to bottom, ${x.colors?.hover} 1px, transparent 1px)`,backgroundPosition:`${Ie}px ${Le}px`})),[Oe,Ie,Le,x]),qe=e.useMemo((()=>{const e=Object.values(o).reduce(((e,n)=>{var t;if(n.root||"comment"===n.type)return e;const o=null!==(t=n.category)&&void 0!==t?t:"...";return e[o]||(e[o]=[]),e[o].push(n),e}),{});return Object.entries(e).map((([e,n])=>({category:e,nodeTypes:n})))}),[o]),Ke=e=>({label:Xe(c,"contextMenu.addComment.label",{},"Add comment"),description:Xe(c,"contextMenu.addComment.description",{},"Add a comment to the screen"),onClick:()=>{const n=e.target.getBoundingClientRect(),{x:t,y:o}=n,i={x:(e.clientX-S.x-t)/M,y:(e.clientY-S.y-o)/M};Pe&&(i.x=Math.round(i.x/ke)*ke,i.y=Math.round(i.y/ke)*ke),le(h,i)}}),Je=e.useCallback((e=>({onDragOver:e=>{e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move"},onDragLeave:e=>{e.preventDefault(),e.stopPropagation()},onContextMenu:n=>e(n,[...qe.map((({category:e,nodeTypes:t})=>({label:e,children:t.filter((e=>!e.root&&e.type!==h.type)).sort(((e,n)=>e.label.localeCompare(n.label))).map((e=>({label:Xe(c,"contextMenu.add",{nodeType:e.label},"Add "+e.label),description:e.description,onClick:()=>{var t,o;const i=n.target.getBoundingClientRect(),{x:r,y:s}=i,a={x:(n.clientX-(null!==(t=S?.x)&&void 0!==t?t:0)-r)/M,y:(n.clientY-(null!==(o=S?.y)&&void 0!==o?o:0)-s)/M};Pe&&(a.x=Math.round(a.x/ke)*ke,a.y=Math.round(a.y/ke)*ke),le(e,a)}})))}))),Ke(n)]),onMouseDown:ge,onClick:e=>{e.target===ae.current.instance.wrapperComponent&&re.current.focus({preventScroll:!0})}})),[I,A,qe,le,S,M]),Ue=e.useCallback(((e,n)=>{ve(e,n)}),[ve]),Qe=e.useCallback((()=>{Ne((e=>!e))}),[]);return I?n.jsx("div",{className:Be.container,style:b,ref:re,tabIndex:0,children:n.jsx(Me,{initialScale:null!==(f=I?.scale)&&void 0!==f?f:1,initialPositionX:null!==(m=I?.position?.x)&&void 0!==m?m:0,initialPositionY:null!==(v=I?.position?.y)&&void 0!==v?v:0,disabled:be,minScale:.1,maxScale:2,limitToBounds:!1,onPanning:He,onZoom:Te,pinch:Ae,panning:Re,onTransformed:_e,ref:ae,children:({zoomIn:e,zoomOut:i,resetTransform:r,setTransform:s,centerView:a,...l})=>{const d=se?{x:D.x-se.left,y:D.y-se.top}:{x:0,y:0},p=se?{x:Z.x-se.left,y:Z.y-se.top}:{x:0,y:0};return n.jsxs(n.Fragment,{children:[n.jsx(Pn,{localStartPoint:d,localEndPoint:p}),n.jsx(bn,{zoomIn:e,zoomOut:i,centerView:a,resetView:()=>{s(S.x,S.y,1),N(1)},canMove:we,setCanMove:Se,position:S,scale:M,setStateAndNotify:ie}),n.jsx(Cn,{snapToGrid:Pe,handleSnapToGrid:Qe,viewMode:A}),n.jsx(wn,{scale:M,position:S}),n.jsx($e,{containerRef:re,i18n:c,children:({handleContextMenu:e})=>n.jsxs(Ee,{contentClass:"main",wrapperStyle:We,wrapperProps:Je(e),children:[I?.nodes&&Object.values(I.nodes).map(((i,r)=>{const s=o[i.type];return"comment"===i.type?n.jsx(Fe,{nodeId:i.id,text:i.value||"",title:i.title||"",isSelected:X.includes(i.id),onChangeText:e=>{ie((n=>({...n,nodes:{...n.nodes,[i.id]:{...n.nodes[i.id],value:e}}})))},onChangeTitle:e=>{ie((n=>({...n,nodes:{...n.nodes,[i.id]:{...n.nodes[i.id],title:e}}})))},id:i.id,position:i.position,size:i.size,onResize:e=>{Pe&&(e.w=Math.round(e.w/ke)*ke,e.h=Math.round(e.h/ke)*ke),ie((n=>({...n,nodes:{...n.nodes,[i.id]:{...n.nodes[i.id],size:e}}})))},onMove:e=>Ye(i,e,!1),onMoveEnd:e=>Ye(i,e,!0),onContextMenu:n=>e(n,[{label:Xe(c,"contextMenu.cloneThisComment",{},"Clone this comment"),onClick:()=>{ue(i.id)}},{label:Xe(c,"contextMenu.removeThisComment",{},"Remove this comment"),style:{color:"red"},onClick:()=>{ce([i.id])}},X?.length>0?{label:Xe(c,"contextMenu.removeSelectedNodes",{},"Remove selected nodes"),style:{color:"red"},onClick:()=>{ce(X)}}:null])},i.id):n.jsxs(n.Fragment,{children:[n.jsx(C,{id:`node_${i.id}`,name:i.name,portTypes:t,nodeType:o?.[i.type],debugMode:u,value:i,isSelected:X.includes(i.id),onValueChange:e=>{Ue(i.id,{...e.values})},onChangePosition:e=>Ye(i,e,!1),onDragEnd:e=>Ye(i,e,!0),containerRef:re,canMove:we,onConnect:ze,onContextMenu:n=>e(n,[s.root?null:{label:Xe(c,"contextMenu.cloneThisNode",{},"Clone this node"),onClick:()=>{ue(i.id)}},s.root?null:{label:Xe(c,"contextMenu.removeThisNode",{},"Remove this node"),style:{color:"red"},onClick:()=>{ce([i.id])}},X?.length>0?{label:Xe(c,"contextMenu.removeSelectedNodes",{},"Remove selected nodes"),style:{color:"red"},onClick:()=>{ce(X)}}:null]),onResize:e=>{L((n=>{var t;return{...n,nodes:{...n.nodes,[i.id]:{...n.nodes[i.id],size:e,connections:{...n.nodes[i.id].connections,outputs:[...null!==(t=n.nodes[i.id].connections?.outputs)&&void 0!==t?t:[]]}}}}}))}},`node_${i.id}`),i.connections?.outputs?.map(((o,r)=>{const s=i.id,a=o.name,l=o.node,u=o.port,d=o.type,p=o.waypoints||[],f=document.getElementById(`card-${s}`),m=document.getElementById(`card-${l}`),y=document.getElementById(`card-${s}-output-${a}`),v=document.getElementById(`card-${l}-input-${u}`);if(!(y&&v&&se&&f&&m))return null;const h=y.getBoundingClientRect(),x=v.getBoundingClientRect(),g=f.getBoundingClientRect(),b=m.getBoundingClientRect(),C={x:(h.x-S.x-se.left+h.width/2)/M,y:(h.y-S.y-se.top+h.height/2)/M},w={x:(x.x-S.x-se.left+x.width/2)/M,y:(x.y-S.y-se.top+x.height/2)/M},P={x:(g.x-S.x-se.left)/M,y:(g.y-S.y-se.top)/M,w:g.width,h:g.height},N={x:(b.x-S.x-se.left)/M,y:(b.y-S.y-se.top)/M,w:b.width,h:b.height};return n.jsx(je,{type:t[d],src:C,dst:w,scale:M,n1Box:P,n2Box:N,index:r,waypoints:p,onUpdateWaypoint:(e,n)=>fe(s,a,l,u,e,n),isWaypointSelected:e=>ne({srcNode:s,srcPort:a,dstNode:l,dstPort:u,waypointIndex:e}),onWaypointMouseDown:(e,n)=>{e.ctrlKey?ee({srcNode:s,srcPort:a,dstNode:l,dstPort:u,waypointIndex:n}):e.shiftKey?G({srcNode:s,srcPort:a,dstNode:l,dstPort:u,waypointIndex:n}):ne({srcNode:s,srcPort:a,dstNode:l,dstPort:u,waypointIndex:n})||B([{srcNode:s,srcPort:a,dstNode:l,dstPort:u,waypointIndex:n}])},onWaypointContextMenu:(n,t)=>e(n,[we?{label:Xe(c,"contextMenu.removeWaypoint",{},"Remove waypoint"),style:{color:"red"},onClick:()=>{me(s,a,l,u,t)}}:null].filter(Boolean)),onContextMenu:n=>e(n,[we?{label:Xe(c,"contextMenu.addWaypoint",{},"Add waypoint"),onClick:()=>{const e=(n.clientX-se.left-S.x)/M,t=(n.clientY-se.top-S.y)/M;pe(s,a,l,u,{x:e,y:t})}}:null,we?{label:Xe(c,"contextMenu.removeThisConnection",{},"Remove this connection"),style:{color:"red"},onClick:()=>{de(s,a,l,u)}}:null].filter(Boolean))},`connector-${s}-${a}-${l}-${u}`)}))]})})),(w||j)&&T?n.jsx(Ve,{tmp:!0,invalid:j,src:{x:((w&&w.startX||j&&T.srcX)-se.left-S.x+10-2)/M,y:((w&&w.startY||j&&T.srcY)-se.top-S.y+10-2)/M},dst:{x:(T.x-window.scrollX-se.left-S.x)/M,y:(T.y-window.scrollY-se.top-S.y)/M},scale:M}):null]})})]})}})}):null}exports.NodeContainer=function({theme:e,themes:t,state:i,...r}){return n.jsx(s,{initialState:i,children:n.jsx(o,{children:n.jsx(Nn,{...r})})})},exports.ThemeProvider=({children:t,themes:o,theme:i="light"})=>{const[r,s]=e.useState(p[i]||p.light),[a,l]=e.useState(i);return e.useEffect((()=>{const e=c({},p[a],o?.[a],o?.common);s(e)}),[a,o]),e.useEffect((()=>{l(i||"light")}),[i]),r?n.jsx(m.Provider,{value:{themeName:a,currentTheme:r,setThemeName:l},children:t}):null},exports.useTheme=y;
